<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartBTP â€” Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=JetBrains+Mono:wght@400;600;700&display=swap">
<style>
:root {
  --gold:#E8B84B; --gold2:#C49030; --gold3:#F5D07A;
  --gold-dim:rgba(232,184,75,0.1); --gold-glow:rgba(232,184,75,0.35);
  --bg:#060A10; --bg2:#0C1220; --bg3:#0F1828; --bg4:#141E2E;
  --border:rgba(255,255,255,0.06); --border2:rgba(255,255,255,0.1);
  --text:#EDF2F7; --muted:#8892A4; --dim:#4A5B7A;
  --green:#34C38F; --blue:#4A90E2; --red:#F04E6A; --purple:#9B6DFF; --orange:#FF7043;
  --sidebar-w:240px; --radius:12px; --radius-lg:18px;
  --shadow:0 8px 32px rgba(0,0,0,0.3);
  --transition:all 0.25s cubic-bezier(0.4,0,0.2,1);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.12);border-radius:3px}
.mono{font-family:'JetBrains Mono',monospace}
.app-shell{display:flex;min-height:100vh}
.main-wrap{margin-right:var(--sidebar-w);flex:1;display:flex;flex-direction:column;min-height:100vh}
.page-content{flex:1;padding:1.8rem;max-width:1400px;width:100%}

/* ===== SIDEBAR ===== */
.sidebar{width:var(--sidebar-w);background:var(--bg2);border-left:1px solid var(--border);display:flex;flex-direction:column;position:fixed;top:0;right:0;height:100vh;z-index:200;transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);overflow:hidden}
.sidebar::before{content:'';position:absolute;top:0;left:0;right:0;height:180px;background:radial-gradient(ellipse at 50% -20%,rgba(232,184,75,0.08),transparent 70%);pointer-events:none}
.sidebar-logo{padding:1.2rem 1.4rem;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:0.7rem}
.sidebar-logo-icon{width:36px;height:36px;background:linear-gradient(135deg,#E8B84B,#C49030);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
.sidebar-logo-text{font-size:1rem;font-weight:900;color:var(--gold)}
.sidebar-logo-sub{font-size:0.65rem;color:var(--dim)}
.sidebar-nav{flex:1;overflow-y:auto;padding:0.8rem 0.7rem}
.nav-section-label{font-size:0.62rem;font-weight:800;color:var(--dim);letter-spacing:1px;padding:0.6rem 0.7rem 0.3rem;text-transform:uppercase}
.nav-link{display:flex;align-items:center;gap:0.6rem;padding:0.55rem 0.8rem;border-radius:var(--radius);color:var(--muted);text-decoration:none;font-size:0.84rem;font-weight:600;transition:var(--transition);cursor:pointer;border:none;background:none;width:100%;font-family:'Tajawal',sans-serif}
.nav-link:hover{background:rgba(255,255,255,0.05);color:var(--text)}
.nav-link.active{background:var(--gold-dim);color:var(--gold)}
.nav-link-icon{width:18px;text-align:center;font-size:0.95rem}
.nav-badge{font-size:0.58rem;padding:2px 7px;border-radius:20px;font-weight:800;margin-right:auto}
.sidebar-footer{padding:0.8rem;border-top:1px solid var(--border)}
.tenant-chip{display:flex;align-items:center;gap:0.6rem;padding:0.6rem 0.8rem;background:rgba(255,255,255,0.03);border-radius:var(--radius);margin-bottom:0.5rem}
.tenant-avatar{width:32px;height:32px;border-radius:50%;background:var(--gold-dim);border:1px solid rgba(232,184,75,0.3);display:flex;align-items:center;justify-content:center;font-size:1rem}
.tenant-name{font-size:0.8rem;font-weight:700;color:var(--text)}
.tenant-plan{font-size:0.65rem;color:var(--dim)}
.nav-link.logout{color:var(--red);margin-top:0.3rem}
.nav-link.logout:hover{background:rgba(240,78,106,0.1)}

/* ===== TOPBAR ===== */
.topbar{height:58px;background:rgba(6,10,16,0.8);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 1.8rem;position:sticky;top:0;z-index:100}
.topbar-breadcrumb{font-size:0.82rem;color:var(--muted)}
.topbar-user{display:flex;align-items:center;gap:0.5rem}
.topbar-avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#E8B84B,#C49030);display:flex;align-items:center;justify-content:center;font-size:0.78rem;font-weight:900;color:#09120A;cursor:pointer}
.hamburger{display:none;background:none;border:none;cursor:pointer;color:var(--muted);font-size:1.3rem;padding:4px}

/* ===== BUTTONS ===== */
.btn{display:inline-flex;align-items:center;gap:0.4rem;padding:0.5rem 1rem;border-radius:var(--radius);border:none;font-family:'Tajawal',sans-serif;font-size:0.85rem;font-weight:700;cursor:pointer;text-decoration:none;transition:var(--transition);user-select:none}
.btn:active{transform:scale(0.97)}
.btn-gold{background:linear-gradient(135deg,#E8B84B,#C49030);color:#09120A;box-shadow:0 3px 14px rgba(232,184,75,0.3)}
.btn-gold:hover{box-shadow:0 6px 22px rgba(232,184,75,0.45);transform:translateY(-1px)}
.btn-blue{background:rgba(74,144,226,0.12);border:1px solid rgba(74,144,226,0.3);color:#60A5FA}
.btn-blue:hover{background:rgba(74,144,226,0.22);transform:translateY(-1px)}
.btn-red{background:rgba(240,78,106,0.1);border:1px solid rgba(240,78,106,0.3);color:#F79FA9}
.btn-red:hover{background:rgba(240,78,106,0.2);transform:translateY(-1px)}
.btn-green{background:rgba(52,195,143,0.12);border:1px solid rgba(52,195,143,0.3);color:#34C38F}
.btn-green:hover{background:rgba(52,195,143,0.22);transform:translateY(-1px)}
.btn-ghost{background:rgba(255,255,255,0.05);border:1px solid var(--border2);color:var(--muted)}
.btn-ghost:hover{background:rgba(255,255,255,0.1);color:var(--text)}
.btn-sm{padding:0.3rem 0.7rem;font-size:0.78rem;border-radius:8px}
.btn-lg{padding:0.75rem 1.4rem;font-size:1rem}
.btn-outline-gold{background:transparent;border:2px solid var(--gold);color:var(--gold)}
.btn-outline-gold:hover{background:var(--gold);color:#09120A}

/* ===== FORMS ===== */
.form-group{margin-bottom:1rem}
.form-label{display:block;font-size:0.78rem;font-weight:700;color:var(--muted);margin-bottom:0.35rem}
.form-input,.form-select,.form-textarea{width:100%;padding:0.68rem 1rem;background:rgba(255,255,255,0.04);border:1px solid var(--border2);border-radius:var(--radius);color:var(--text);font-family:'Tajawal',sans-serif;font-size:0.88rem;outline:none;transition:border-color 0.2s,box-shadow 0.2s}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(232,184,75,0.12)}
.form-input::placeholder{color:var(--dim)}
.form-select option{background:#1a2535}
.form-textarea{resize:vertical;min-height:70px}
.form-grid-2{display:grid;grid-template-columns:1fr 1fr;gap:0.75rem}
.form-grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.75rem}

/* ===== MODAL ===== */
.modal-overlay{position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,0.72);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;animation:overlayIn 0.2s ease}
.modal-overlay.show{display:flex}
@keyframes overlayIn{from{opacity:0}to{opacity:1}}
.modal{background:var(--bg3);border:1px solid var(--border2);border-radius:20px;padding:1.8rem;width:90%;max-width:560px;max-height:90vh;overflow-y:auto;animation:modalIn 0.32s cubic-bezier(0.34,1.56,0.64,1);box-shadow:0 24px 80px rgba(0,0,0,0.5)}
.modal-lg{max-width:680px}
@keyframes modalIn{from{opacity:0;transform:scale(0.88) translateY(24px)}to{opacity:1;transform:none}}
.modal-title{font-size:1.15rem;font-weight:900;margin-bottom:1.3rem;padding-bottom:0.8rem;border-bottom:1px solid var(--border)}
.modal-footer{display:flex;gap:0.6rem;margin-top:1.3rem;padding-top:1rem;border-top:1px solid var(--border)}

/* ===== TABLE ===== */
.table-wrap{overflow-x:auto;border-radius:var(--radius-lg);border:1px solid var(--border)}
table{width:100%;border-collapse:collapse}
thead th{padding:0.85rem 1rem;font-size:0.73rem;font-weight:800;color:var(--dim);background:rgba(255,255,255,0.02);border-bottom:1px solid var(--border);white-space:nowrap;text-align:right}
tbody td{padding:0.78rem 1rem;font-size:0.84rem;border-bottom:1px solid rgba(255,255,255,0.04);color:var(--text);vertical-align:middle}
tbody tr:last-child td{border-bottom:none}
tbody tr:hover td{background:rgba(255,255,255,0.03)}

/* ===== BADGES ===== */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:0.7rem;font-weight:700;white-space:nowrap}
.badge-active{background:rgba(52,195,143,0.12);color:#34C38F;border:1px solid rgba(52,195,143,0.25)}
.badge-completed{background:rgba(74,144,226,0.12);color:#60A5FA;border:1px solid rgba(74,144,226,0.25)}
.badge-delayed{background:rgba(240,78,106,0.12);color:#F79FA9;border:1px solid rgba(240,78,106,0.25)}
.badge-revenue{background:rgba(52,195,143,0.12);color:#34C38F;border:1px solid rgba(52,195,143,0.25)}
.badge-expense{background:rgba(240,78,106,0.12);color:#F79FA9;border:1px solid rgba(240,78,106,0.25)}

/* ===== CARDS ===== */
.card{background:rgba(255,255,255,0.025);border:1px solid var(--border);border-radius:var(--radius-lg);padding:1.3rem;transition:var(--transition)}
.card:hover{border-color:rgba(255,255,255,0.12);transform:translateY(-2px);box-shadow:var(--shadow)}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:0.8rem;margin-bottom:1.5rem}
.stat-card{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:var(--radius-lg);padding:1.1rem 1.2rem;transition:var(--transition)}
.stat-card:hover{border-color:rgba(255,255,255,0.14);transform:translateY(-2px)}
.stat-icon{font-size:1.4rem;margin-bottom:0.4rem}
.stat-value{font-size:1.6rem;font-weight:900;font-family:'JetBrains Mono',monospace}
.stat-label{font-size:0.72rem;color:var(--dim);margin-top:3px}
.grid-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1rem}

/* ===== PROGRESS ===== */
.progress-bar{height:6px;border-radius:4px;background:rgba(255,255,255,0.07);overflow:hidden}
.progress-fill{height:100%;border-radius:4px;transition:width 1.2s cubic-bezier(0.34,1.56,0.64,1)}

/* ===== PAGE HEADER ===== */
.page-header{display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap}
.page-title{font-size:1.5rem;font-weight:900;margin-bottom:0.2rem}
.page-sub{font-size:0.82rem;color:var(--dim)}
.page-actions{display:flex;align-items:center;gap:0.6rem;flex-wrap:wrap}

/* ===== EMPTY STATE ===== */
.empty{text-align:center;padding:4rem 1rem}
.empty-icon{font-size:3.5rem;margin-bottom:1rem;opacity:0.4}
.empty-title{font-size:1.1rem;font-weight:800;color:var(--muted);margin-bottom:0.5rem}
.empty-text{font-size:0.85rem;color:var(--dim);line-height:1.7}

/* ===== TOAST ===== */
.toast-container{position:fixed;bottom:1.5rem;right:1.5rem;z-index:9999;display:flex;flex-direction:column;gap:0.5rem}
.toast{display:flex;align-items:center;gap:0.6rem;padding:0.75rem 1.1rem;border-radius:var(--radius);font-size:0.87rem;font-weight:700;box-shadow:0 8px 24px rgba(0,0,0,0.4);animation:toastIn 0.4s cubic-bezier(0.34,1.56,0.64,1);max-width:340px;backdrop-filter:blur(12px)}
@keyframes toastIn{from{opacity:0;transform:translateX(30px) scale(0.9)}to{opacity:1;transform:none}}
.toast-success{background:rgba(52,195,143,0.15);border:1px solid rgba(52,195,143,0.4);color:#6eddb5}
.toast-error{background:rgba(240,78,106,0.15);border:1px solid rgba(240,78,106,0.4);color:#f79fa9}
.toast-info{background:rgba(74,144,226,0.15);border:1px solid rgba(74,144,226,0.4);color:#60A5FA}

/* ===== ALERTS ===== */
.alert{padding:0.78rem 1rem;border-radius:var(--radius);font-size:0.87rem;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem}
.alert-success{background:rgba(52,195,143,0.1);border:1px solid rgba(52,195,143,0.3);color:#6eddb5}
.alert-error{background:rgba(240,78,106,0.1);border:1px solid rgba(240,78,106,0.3);color:#f79fa9}

/* ===== ANIMATIONS ===== */
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideDown{from{opacity:0;transform:translateY(-12px)}to{opacity:1;transform:none}}
@keyframes slideUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:none}}
@keyframes floatUp{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
.animate-fade{animation:fadeIn 0.5s ease both}
.animate-up{animation:slideUp 0.4s ease both}

/* ===== COLOR OPTIONS ===== */
.color-options{display:flex;flex-wrap:wrap;gap:0.5rem}
.color-option{width:26px;height:26px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
.color-option:hover{transform:scale(1.2)}
.color-option.selected{border-color:#fff;transform:scale(1.25);box-shadow:0 0 0 3px rgba(255,255,255,0.2)}

/* ===== LANDING PAGE ===== */
.landing-page{min-height:100vh;background:var(--bg);overflow-x:hidden}

/* Landing Navbar */
.land-nav{position:fixed;top:0;left:0;right:0;z-index:500;padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between;background:rgba(6,10,16,0.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);transition:all 0.3s}
.land-nav-logo{display:flex;align-items:center;gap:0.7rem}
.land-nav-logo-icon{width:38px;height:38px;background:linear-gradient(135deg,#E8B84B,#C49030);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;box-shadow:0 4px 14px rgba(232,184,75,0.35)}
.land-nav-logo-text{font-size:1.1rem;font-weight:900;color:var(--gold)}
.land-nav-links{display:flex;align-items:center;gap:0.3rem}
.land-nav-link{padding:0.45rem 0.85rem;border-radius:8px;color:var(--muted);font-size:0.85rem;font-weight:600;cursor:pointer;transition:var(--transition);border:none;background:none;font-family:'Tajawal',sans-serif;text-decoration:none}
.land-nav-link:hover{color:var(--text);background:rgba(255,255,255,0.06)}
.land-nav-actions{display:flex;align-items:center;gap:0.6rem}

/* Hero Section */
.hero{position:relative;min-height:100vh;display:flex;align-items:center;justify-content:center;text-align:center;padding:6rem 2rem 4rem;overflow:hidden}
.hero-bg{position:absolute;inset:0;z-index:0}
.hero-bg-img{position:absolute;inset:0;background:url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=1920&q=80') center/cover no-repeat;opacity:0.12;filter:saturate(0.5)}
.hero-bg-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(232,184,75,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(232,184,75,0.03) 1px,transparent 1px);background-size:50px 50px}
.hero-bg-glow{position:absolute;inset:0;background:radial-gradient(ellipse at 50% 40%,rgba(232,184,75,0.08) 0%,transparent 60%)}
.hero-content{position:relative;z-index:1;max-width:860px;margin:0 auto}
.hero-badge{display:inline-flex;align-items:center;gap:0.5rem;background:rgba(232,184,75,0.1);border:1px solid rgba(232,184,75,0.25);border-radius:30px;padding:0.4rem 1rem;font-size:0.78rem;font-weight:700;color:var(--gold);margin-bottom:1.5rem;animation:slideDown 0.6s ease}
.hero-title{font-size:clamp(2rem,5vw,3.8rem);font-weight:900;line-height:1.15;margin-bottom:1.2rem;animation:slideUp 0.7s ease 0.1s both}
.hero-title span{background:linear-gradient(135deg,#E8B84B,#F5D07A,#C49030);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;background-size:200%;animation:shimmer 3s linear infinite}
.hero-sub{font-size:clamp(1rem,2vw,1.2rem);color:var(--muted);max-width:580px;margin:0 auto 2.5rem;line-height:1.7;animation:slideUp 0.7s ease 0.2s both}
.hero-actions{display:flex;align-items:center;justify-content:center;gap:1rem;flex-wrap:wrap;animation:slideUp 0.7s ease 0.3s both}
.hero-stats{display:flex;align-items:center;justify-content:center;gap:2.5rem;margin-top:3rem;flex-wrap:wrap;animation:slideUp 0.7s ease 0.4s both}
.hero-stat{text-align:center}
.hero-stat-val{font-size:1.8rem;font-weight:900;color:var(--gold);font-family:'JetBrains Mono',monospace}
.hero-stat-label{font-size:0.72rem;color:var(--dim);margin-top:2px}
.hero-divider{width:1px;height:40px;background:var(--border)}

/* Features Section */
.section{padding:5rem 2rem}
.section-center{text-align:center;max-width:700px;margin:0 auto 3.5rem}
.section-tag{display:inline-block;background:rgba(74,144,226,0.1);border:1px solid rgba(74,144,226,0.25);border-radius:20px;padding:0.3rem 0.9rem;font-size:0.75rem;font-weight:800;color:#60A5FA;margin-bottom:0.8rem;letter-spacing:1px;text-transform:uppercase}
.section-title{font-size:clamp(1.6rem,3.5vw,2.5rem);font-weight:900;margin-bottom:0.8rem}
.section-sub{font-size:0.95rem;color:var(--muted);line-height:1.7}

.features-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;max-width:1200px;margin:0 auto}
.feature-card{background:rgba(255,255,255,0.025);border:1px solid var(--border);border-radius:20px;padding:1.8rem;transition:all 0.3s;position:relative;overflow:hidden}
.feature-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);opacity:0;transition:opacity 0.3s}
.feature-card:hover{border-color:rgba(232,184,75,0.2);transform:translateY(-4px);box-shadow:0 20px 50px rgba(0,0,0,0.3)}
.feature-card:hover::before{opacity:1}
.feature-icon{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin-bottom:1.2rem}
.feature-icon.blue{background:rgba(74,144,226,0.12);border:1px solid rgba(74,144,226,0.2)}
.feature-icon.gold{background:rgba(232,184,75,0.12);border:1px solid rgba(232,184,75,0.2)}
.feature-icon.green{background:rgba(52,195,143,0.12);border:1px solid rgba(52,195,143,0.2)}
.feature-icon.purple{background:rgba(155,109,255,0.12);border:1px solid rgba(155,109,255,0.2)}
.feature-icon.red{background:rgba(240,78,106,0.12);border:1px solid rgba(240,78,106,0.2)}
.feature-icon.orange{background:rgba(255,112,67,0.12);border:1px solid rgba(255,112,67,0.2)}
.feature-title{font-size:1rem;font-weight:800;margin-bottom:0.5rem}
.feature-desc{font-size:0.85rem;color:var(--muted);line-height:1.6}

/* Projects Showcase */
.projects-showcase{padding:5rem 2rem;background:linear-gradient(180deg,transparent,rgba(255,255,255,0.01),transparent)}
.projects-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem;max-width:1200px;margin:0 auto}
.project-img-card{border-radius:20px;overflow:hidden;border:1px solid var(--border);transition:all 0.3s;position:relative}
.project-img-card:hover{transform:translateY(-5px);box-shadow:0 25px 60px rgba(0,0,0,0.4);border-color:rgba(232,184,75,0.2)}
.project-img-card img{width:100%;height:220px;object-fit:cover;display:block;filter:saturate(0.85) brightness(0.9)}
.project-img-card:hover img{filter:saturate(1) brightness(1)}
.project-img-info{padding:1.2rem;background:var(--bg3)}
.project-img-title{font-size:0.95rem;font-weight:800;margin-bottom:0.3rem}
.project-img-meta{font-size:0.75rem;color:var(--dim)}
.project-img-overlay{position:absolute;top:0.7rem;right:0.7rem}

/* Pricing Section */
.pricing-section{padding:5rem 2rem;background:rgba(255,255,255,0.01)}
.pricing-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;max-width:1000px;margin:0 auto}
.pricing-card{background:var(--bg3);border:1px solid var(--border2);border-radius:24px;padding:2rem;transition:all 0.3s;position:relative;overflow:hidden}
.pricing-card.popular{border-color:rgba(232,184,75,0.4);box-shadow:0 0 50px rgba(232,184,75,0.08)}
.pricing-popular-badge{position:absolute;top:-1px;right:50%;transform:translateX(50%);background:linear-gradient(135deg,#E8B84B,#C49030);color:#09120A;font-size:0.7rem;font-weight:900;padding:0.3rem 1rem;border-radius:0 0 12px 12px}
.pricing-name{font-size:1rem;font-weight:900;color:var(--muted);margin-bottom:0.5rem}
.pricing-price{font-size:2.5rem;font-weight:900;color:var(--text);font-family:'JetBrains Mono',monospace;line-height:1}
.pricing-price span{font-size:0.85rem;font-weight:400;color:var(--dim);font-family:'Tajawal',sans-serif}
.pricing-period{font-size:0.75rem;color:var(--dim);margin-bottom:1.5rem}
.pricing-features{list-style:none;margin-bottom:1.8rem}
.pricing-features li{display:flex;align-items:center;gap:0.5rem;font-size:0.85rem;color:var(--muted);padding:0.4rem 0;border-bottom:1px solid rgba(255,255,255,0.03)}
.pricing-features li:last-child{border-bottom:none}
.pricing-features li .check{color:var(--green);font-size:0.8rem;flex-shrink:0}
.pricing-features li .x{color:var(--dim);font-size:0.8rem;flex-shrink:0}

/* CTA Section */
.cta-section{padding:5rem 2rem;text-align:center;position:relative;overflow:hidden}
.cta-section::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% 50%,rgba(232,184,75,0.06),transparent 60%);pointer-events:none}
.cta-box{max-width:680px;margin:0 auto;position:relative;z-index:1}
.cta-title{font-size:clamp(1.8rem,4vw,3rem);font-weight:900;margin-bottom:1rem}
.cta-sub{font-size:1rem;color:var(--muted);margin-bottom:2rem;line-height:1.7}

/* Landing Footer */
.land-footer{padding:2rem;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:gap;background:var(--bg2)}
.land-footer-logo{display:flex;align-items:center;gap:0.7rem}
.land-footer-text{font-size:0.78rem;color:var(--dim)}

/* ===== LOGIN PAGE ===== */
.login-page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:var(--bg);position:relative;overflow:hidden}
.login-page::before{content:'';position:fixed;inset:0;background:url('https://images.unsplash.com/photo-1541888946425-d81bb19240f5?w=1920&q=80') center/cover no-repeat;opacity:0.06;filter:saturate(0.3) blur(2px);pointer-events:none}
.login-page::after{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(255,255,255,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.02) 1px,transparent 1px);background-size:50px 50px;pointer-events:none}
.login-wrap{display:grid;grid-template-columns:1fr 1fr;width:100%;max-width:1000px;z-index:1;margin:2rem;border-radius:28px;overflow:hidden;box-shadow:0 40px 100px rgba(0,0,0,0.5);border:1px solid var(--border2)}
.login-left{position:relative;padding:3rem;background:linear-gradient(135deg,var(--bg3),var(--bg4));display:flex;flex-direction:column;justify-content:center}
.login-left-bg{position:absolute;inset:0;background:url('https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=800&q=80') center/cover no-repeat;opacity:0.12;filter:saturate(0.4)}
.login-left-overlay{position:absolute;inset:0;background:linear-gradient(135deg,rgba(6,10,16,0.7),rgba(12,18,32,0.85))}
.login-left-content{position:relative;z-index:1}
.login-left-logo{display:flex;align-items:center;gap:0.8rem;margin-bottom:2.5rem}
.login-left-logo-icon{width:44px;height:44px;background:linear-gradient(135deg,#E8B84B,#C49030);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;box-shadow:0 6px 20px rgba(232,184,75,0.35)}
.login-left-logo-text{font-size:1.3rem;font-weight:900;color:var(--gold)}
.login-left-title{font-size:1.8rem;font-weight:900;margin-bottom:0.8rem}
.login-left-sub{font-size:0.9rem;color:var(--muted);line-height:1.7;margin-bottom:2rem}
.login-left-features{display:flex;flex-direction:column;gap:0.7rem}
.login-left-feat{display:flex;align-items:center;gap:0.7rem;font-size:0.85rem;color:var(--muted)}
.login-left-feat-icon{width:28px;height:28px;border-radius:8px;background:rgba(232,184,75,0.1);border:1px solid rgba(232,184,75,0.2);display:flex;align-items:center;justify-content:center;font-size:0.85rem;flex-shrink:0}
.login-right{background:var(--bg3);padding:3rem}
.login-tabs{display:flex;gap:0.5rem;background:rgba(255,255,255,0.04);border-radius:12px;padding:0.3rem;margin-bottom:1.8rem}
.login-tab{flex:1;padding:0.5rem;border-radius:9px;border:none;font-family:'Tajawal',sans-serif;font-size:0.82rem;font-weight:700;cursor:pointer;transition:all 0.2s;color:var(--dim);background:none}
.login-tab.active{background:var(--bg);color:var(--text);box-shadow:0 2px 8px rgba(0,0,0,0.3)}
.login-right-logo{margin-bottom:2rem}
.login-right-title{font-size:1.5rem;font-weight:900;margin-bottom:0.4rem}
.login-right-sub{font-size:0.82rem;color:var(--dim);margin-bottom:1.8rem}
.login-demo-box{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:var(--radius);padding:0.85rem 1rem;margin-top:1rem}
.login-demo-title{font-size:0.72rem;color:var(--dim);font-weight:700;margin-bottom:0.4rem;text-transform:uppercase;letter-spacing:0.5px}
.login-demo-row{font-size:0.77rem;color:var(--muted);margin-bottom:0.25rem;display:flex;align-items:center;gap:0.4rem}
.login-back-btn{position:fixed;top:1.2rem;right:1.5rem;z-index:600;background:rgba(255,255,255,0.06);border:1px solid var(--border2);border-radius:10px;padding:0.5rem 1rem;color:var(--muted);font-size:0.82rem;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;transition:var(--transition);display:flex;align-items:center;gap:0.4rem}
.login-back-btn:hover{background:rgba(255,255,255,0.1);color:var(--text)}

/* ===== RESPONSIVE ===== */
@media(max-width:768px){
  .sidebar{transform:translateX(100%)}
  .sidebar.open{transform:translateX(0);box-shadow:-20px 0 60px rgba(0,0,0,0.5)}
  .main-wrap{margin-right:0}
  .hamburger{display:block}
  .page-content{padding:1rem}
  .form-grid-2,.form-grid-3{grid-template-columns:1fr}
  .grid-cards{grid-template-columns:1fr}
  .login-wrap{grid-template-columns:1fr;max-width:480px}
  .login-left{display:none}
  .land-nav-links{display:none}
  .hero-stats{gap:1.2rem}
  .hero-divider{display:none}
}
@media(max-width:480px){
  .stats-grid{grid-template-columns:1fr 1fr}
}
</style>
</head>
<body>

<div id="app"></div>
<div class="toast-container" id="toastContainer"></div>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATABASE â€” localStorage
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DB = {
  get(key) {
    try { return JSON.parse(localStorage.getItem('sbtp_' + key)) || []; } catch { return []; }
  },
  set(key, val) { localStorage.setItem('sbtp_' + key, JSON.stringify(val)); },
  nextId(key) {
    const items = this.get(key);
    return items.length ? Math.max(...items.map(i => i.id)) + 1 : 1;
  },
  init() {
    if (this.get('initialized').length) return;
    this.set('plans', [
      { id:1, slug:'starter',    name:'Ø§Ù„Ù…Ø¨ØªØ¯Ø¦',   price:2900,  max_projects:3,  max_workers:15,  max_equipment:0  },
      { id:2, slug:'pro',        name:'Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ', price:7900,  max_projects:20, max_workers:100, max_equipment:50 },
      { id:3, slug:'enterprise', name:'Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ',   price:19900, max_projects:-1, max_workers:-1,  max_equipment:-1 },
    ]);
    this.set('tenants', [
      { id:1, name:'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ù„Ù„Ø¨Ù†Ø§Ø¡', plan_id:2, wilaya:'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', subscription_status:'active', is_active:true }
    ]);
    this.set('users', [
      { id:1, tenant_id:null, full_name:'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…', email:'admin@smartbtp.dz', password:'Admin@SmartBTP2025', role:'admin', is_admin:true, is_active:true },
      { id:2, tenant_id:1, full_name:'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ù…ÙŠÙ† Ø¨ÙˆØ¹Ù„Ø§Ù…', email:'demo@algerie-construction.dz', password:'Demo@1234', role:'admin', is_admin:false, is_active:true },
    ]);
    this.set('projects', [
      { id:1, tenant_id:1, name:'Ø¨Ù†Ø§Ø¡ Ø¹Ù…Ø§Ø±Ø© R+5 Ø­ÙŠØ¯Ø±Ø©', wilaya:'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', client_name:'Ø¹Ø¨Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ø± Ø¨Ù† Ø¹Ù„ÙŠ', budget:45000000, total_spent:18500000, progress:42, status:'active', color:'#4A90E2', phase:'Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø®Ø±Ø³Ø§Ù†ÙŠ', start_date:'2024-03-01', end_date:'2025-12-31', is_archived:false },
      { id:2, tenant_id:1, name:'ÙÙŠÙ„Ø§ Ø³ÙƒÙ†ÙŠØ© Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡', wilaya:'Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©', client_name:'Ø³Ù…ÙŠØ± Ø­Ù…Ø§Ø¯Ø©', budget:12500000, total_spent:12800000, progress:98, status:'completed', color:'#34C38F', phase:'Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ', start_date:'2023-06-01', end_date:'2024-11-30', is_archived:false },
      { id:3, tenant_id:1, name:'Ù…Ø³ØªÙˆØ¯Ø¹ ØªØ¬Ø§Ø±ÙŠ ÙˆÙ‡Ø±Ø§Ù†', wilaya:'ÙˆÙ‡Ø±Ø§Ù†', client_name:'Ø´Ø±ÙƒØ© Ù„ÙˆØ¬ÙŠØ³ØªÙŠÙƒ', budget:22000000, total_spent:8900000, progress:35, status:'active', color:'#E8B84B', phase:'Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„Ø¬Ø¯Ø±Ø§Ù†', start_date:'2024-08-15', end_date:'2025-08-14', is_archived:false },
      { id:4, tenant_id:1, name:'Ù…Ø¯Ø±Ø³Ø© Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ø¨Ø¬Ø§ÙŠØ©', wilaya:'Ø¨Ø¬Ø§ÙŠØ©', client_name:'Ø¨Ù„Ø¯ÙŠØ© Ø¨Ø¬Ø§ÙŠØ©', budget:31000000, total_spent:5200000, progress:15, status:'delayed', color:'#F04E6A', phase:'Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø­ÙØ± ÙˆØ§Ù„Ø£Ø³Ø§Ø³Ø§Øª', start_date:'2024-01-10', end_date:'2025-06-30', is_archived:false },
    ]);
    this.set('workers', [
      { id:1, tenant_id:1, project_id:1, full_name:'Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ù…ÙŠÙ† Ø²Ø±ÙˆÙ‚', role:'Ø¨Ù†Ù‘Ø§Ø¡ Ø±Ø¦ÙŠØ³ÙŠ', phone:'0550 111 222', daily_salary:3500, contract_type:'daily', hire_date:'2024-03-01', color:'#4A90E2' },
      { id:2, tenant_id:1, project_id:1, full_name:'ÙƒØ±ÙŠÙ… Ø¨Ù† Ø¹Ø²ÙŠØ²', role:'Ø­Ø¯Ø§Ø¯', phone:'0661 333 444', daily_salary:4000, contract_type:'daily', hire_date:'2024-03-15', color:'#34C38F' },
      { id:3, tenant_id:1, project_id:1, full_name:'ÙŠÙˆØ³Ù Ø´Ø±ÙŠÙ', role:'ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ', phone:'0770 555 666', daily_salary:4500, contract_type:'monthly', hire_date:'2024-04-01', color:'#E8B84B' },
      { id:4, tenant_id:1, project_id:3, full_name:'ÙØ±ÙŠØ¯ Ø¨ÙˆØ²ÙŠØ¯ÙŠ', role:'Ø³Ø¨Ø§Ùƒ', phone:'0555 777 888', daily_salary:4200, contract_type:'daily', hire_date:'2024-05-01', color:'#9B6DFF' },
      { id:5, tenant_id:1, project_id:3, full_name:'Ø¹Ù…Ø± Ø­Ù…Ø²Ø©', role:'Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ù†Ù‘Ø§Ø¡', phone:'0660 999 111', daily_salary:2500, contract_type:'daily', hire_date:'2024-06-01', color:'#FF7043' },
    ]);
    this.set('equipment', [
      { id:1, tenant_id:1, project_id:1, name:'Ø­ÙØ§Ø±Ø© ÙƒØ§ØªØ±Ø¨ÙŠÙ„Ø±', model:'CAT 320', plate_number:'16-1234-16', icon:'ğŸšœ', status:'active', purchase_price:8500000, notes:'' },
      { id:2, tenant_id:1, project_id:1, name:'Ø´Ø§Ø­Ù†Ø© Ø®Ù„Ø· Ø§Ù„Ø®Ø±Ø³Ø§Ù†Ø©', model:'Mercedes 3344', plate_number:'16-5678-16', icon:'ğŸš›', status:'active', purchase_price:4200000, notes:'' },
      { id:3, tenant_id:1, project_id:3, name:'Ø±Ø§ÙØ¹Ø© Ø¨Ø±Ø¬ÙŠØ© 50T', model:'Potain MCT 88', plate_number:'', icon:'ğŸ—ï¸', status:'maintenance', purchase_price:12000000, notes:'ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©' },
    ]);
    this.set('transactions', [
      { id:1, tenant_id:1, project_id:1, type:'revenue', category:'Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©', amount:10000000, description:'Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ø´Ø±ÙˆØ¹ Ø­ÙŠØ¯Ø±Ø©', date:'2024-03-05', payment_method:'bank' },
      { id:2, tenant_id:1, project_id:1, type:'expense', category:'Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡', amount:4500000, description:'Ø­Ø¯ÙŠØ¯ ØªØ³Ù„ÙŠØ­ ÙˆØ£Ø³Ù…Ù†Øª', date:'2024-03-15', payment_method:'cash' },
      { id:3, tenant_id:1, project_id:1, type:'expense', category:'Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø¹Ù…Ø§Ù„', amount:2800000, description:'Ø±ÙˆØ§ØªØ¨ Ø´Ù‡Ø± Ù…Ø§Ø±Ø³', date:'2024-03-31', payment_method:'bank' },
      { id:4, tenant_id:1, project_id:2, type:'revenue', category:'Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ', amount:12500000, description:'Ø¯ÙØ¹Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙÙŠÙ„Ø§ Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡', date:'2024-11-30', payment_method:'bank' },
      { id:5, tenant_id:1, project_id:3, type:'expense', category:'Ø§ÙƒØ±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø§Øª', amount:1200000, description:'Ø¥ÙŠØ¬Ø§Ø± Ø´Ø§Ø­Ù†Ø§Øª Ù„Ù†Ù‚Ù„ Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡', date:'2024-09-10', payment_method:'cash' },
    ]);
    this.set('attendance', []);
    this.set('initialized', [true]);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const Auth = {
  currentUser: null,
  login(email, password, type) {
    const users = DB.get('users');
    const user = users.find(u => u.email === email.trim().toLowerCase() && u.is_active);
    if (!user || user.password !== password) return false;
    if (type === 'admin' && !user.is_admin) return false;
    if (type === 'tenant' && (user.is_admin || !user.tenant_id)) return false;
    if (type === 'tenant' && user.tenant_id) {
      const tenant = DB.get('tenants').find(t => t.id === user.tenant_id);
      if (!tenant || !tenant.is_active) return false;
    }
    this.currentUser = user;
    sessionStorage.setItem('sbtp_user', JSON.stringify(user));
    return true;
  },
  logout() { this.currentUser = null; sessionStorage.removeItem('sbtp_user'); App.navigate('landing'); },
  load() { const u = sessionStorage.getItem('sbtp_user'); if (u) this.currentUser = JSON.parse(u); },
  getUser() { return this.currentUser; },
  getTenant() {
    if (!this.currentUser || !this.currentUser.tenant_id) return null;
    return DB.get('tenants').find(t => t.id === this.currentUser.tenant_id) || null;
  },
  getPlan() {
    const t = this.getTenant(); if (!t) return null;
    return DB.get('plans').find(p => p.id === t.plan_id) || null;
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const Toast = {
  show(msg, type='info') {
    const icons = { success:'âœ…', error:'âŒ', info:'â„¹ï¸' };
    const c = document.getElementById('toastContainer');
    const t = document.createElement('div');
    t.className = `toast toast-${type}`;
    t.innerHTML = `<span>${icons[type]||'ğŸ’¬'}</span><span>${msg}</span>`;
    c.appendChild(t);
    setTimeout(() => t.remove(), 4000);
  },
  success: m => Toast.show(m,'success'),
  error: m => Toast.show(m,'error'),
  info: m => Toast.show(m,'info')
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function fmt(n) { return Number(n||0).toLocaleString('fr-DZ'); }
function fmtDate(d) { if (!d) return 'â€”'; return new Date(d).toLocaleDateString('ar-DZ'); }
function statusBadge(s) {
  const map = { active:'badge-active Ù†Ø´Ø·', completed:'badge-completed Ù…ÙƒØªÙ…Ù„', delayed:'badge-delayed Ù…ØªØ£Ø®Ø±', paused:'badge-paused Ù…ØªÙˆÙ‚Ù' };
  const [cls, label] = (map[s]||'badge-paused â€”').split(' ');
  return `<span class="badge ${cls}">${label}</span>`;
}
function statusLabel(s) { return {active:'Ù†Ø´Ø·',completed:'Ù…ÙƒØªÙ…Ù„',delayed:'Ù…ØªØ£Ø®Ø±',paused:'Ù…ØªÙˆÙ‚Ù'}[s]||s; }
function escHtml(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function todayStr() { return new Date().toISOString().split('T')[0]; }

const WILAYAS = ["Ø£Ø¯Ø±Ø§Ø±","Ø§Ù„Ø´Ù„Ù","Ø§Ù„Ø£ØºÙˆØ§Ø·","Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ","Ø¨Ø§ØªÙ†Ø©","Ø¨Ø¬Ø§ÙŠØ©","Ø¨Ø³ÙƒØ±Ø©","Ø¨Ø´Ø§Ø±","Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©","Ø§Ù„Ø¨ÙˆÙŠØ±Ø©","ØªÙ…Ù†Ø±Ø§Ø³Øª","ØªØ¨Ø³Ø©","ØªÙ„Ù…Ø³Ø§Ù†","ØªÙŠØ§Ø±Øª","ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ","Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±","Ø§Ù„Ø¬Ù„ÙØ©","Ø¬ÙŠØ¬Ù„","Ø³Ø·ÙŠÙ","Ø³Ø¹ÙŠØ¯Ø©","Ø³ÙƒÙŠÙƒØ¯Ø©","Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³","Ø¹Ù†Ø§Ø¨Ø©","Ù‚Ø§Ù„Ù…Ø©","Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©","Ø§Ù„Ù…Ø¯ÙŠØ©","Ù…Ø³ØªØºØ§Ù†Ù…","Ø§Ù„Ù…Ø³ÙŠÙ„Ø©","Ù…Ø¹Ø³ÙƒØ±","ÙˆØ±Ù‚Ù„Ø©","ÙˆÙ‡Ø±Ø§Ù†","Ø§Ù„Ø¨ÙŠØ¶","Ø¥Ù„ÙŠØ²ÙŠ","Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬","Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³","Ø§Ù„Ø·Ø§Ø±Ù","ØªÙ†Ø¯ÙˆÙ","ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª","Ø§Ù„ÙˆØ§Ø¯ÙŠ","Ø®Ù†Ø´Ù„Ø©","Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³","ØªÙŠØ¨Ø§Ø²Ø©","Ù…ÙŠÙ„Ø©","Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰","Ø§Ù„Ù†Ø¹Ø§Ù…Ø©","Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª","ØºØ±Ø¯Ø§ÙŠØ©","ØºÙ„ÙŠØ²Ø§Ù†"];
const PHASES = ["ØªØµÙ…ÙŠÙ… ÙˆØ¯Ø±Ø§Ø³Ø©","Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø­ÙØ± ÙˆØ§Ù„Ø£Ø³Ø§Ø³Ø§Øª","Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø®Ø±Ø³Ø§Ù†ÙŠ","Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙˆØ§Ù„Ø¬Ø¯Ø±Ø§Ù†","Ø§Ù„ØªØ³Ù‚ÙŠÙ","Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡","Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø³Ø¨Ø§ÙƒØ©","Ø§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©","Ø§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©","Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"];
const COLORS = ['#4A90E2','#34C38F','#E8B84B','#F04E6A','#9B6DFF','#FF7043','#26C6DA','#AB47BC'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROUTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const App = {
  currentPage: 'landing',
  params: {},
  navigate(page, params={}) {
    this.currentPage = page; this.params = params; this.render();
    window.scrollTo(0,0);
  },
  render() {
    const app = document.getElementById('app');
    const user = Auth.getUser();
    if (!user && !['landing','login'].includes(this.currentPage)) this.currentPage = 'landing';
    if (user && this.currentPage === 'login') this.currentPage = user.is_admin ? 'admin' : 'dashboard';
    if (user && this.currentPage === 'landing') this.currentPage = user.is_admin ? 'admin' : 'dashboard';
    const pages = { landing:Pages.landing, login:Pages.login, dashboard:Pages.dashboard,
      projects:Pages.projects, workers:Pages.workers, equipment:Pages.equipment,
      transactions:Pages.transactions, attendance:Pages.attendance, reports:Pages.reports,
      settings:Pages.settings, admin:Pages.admin };
    const render = pages[this.currentPage];
    if (render) { app.innerHTML = render(); this.bindEvents(); this.animateBars(); }
  },
  bindEvents() {
    document.querySelectorAll('[data-nav]').forEach(el => {
      el.addEventListener('click', e => { e.preventDefault(); App.navigate(el.dataset.nav); });
    });
    document.querySelectorAll('[data-modal-open]').forEach(el => {
      el.addEventListener('click', () => { const m = document.getElementById(el.dataset.modalOpen); if(m) m.classList.add('show'); });
    });
    document.querySelectorAll('[data-modal-close]').forEach(el => {
      el.addEventListener('click', () => { const m = el.closest('.modal-overlay'); if(m) m.classList.remove('show'); });
    });
    document.querySelectorAll('.modal-overlay').forEach(el => {
      el.addEventListener('click', e => { if(e.target===el) el.classList.remove('show'); });
    });
    const ham = document.querySelector('.hamburger');
    if(ham) ham.addEventListener('click', () => document.getElementById('sidebar')?.classList.toggle('open'));
    document.querySelectorAll('[data-logout]').forEach(el => {
      el.addEventListener('click', () => Auth.logout());
    });
    document.querySelectorAll('[data-color]').forEach(el => {
      el.addEventListener('click', () => {
        const target = document.getElementById(el.dataset.target);
        if(target) target.value = el.dataset.color;
        el.closest('.color-options')?.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
      });
    });
  },
  animateBars() {
    setTimeout(() => {
      document.querySelectorAll('.progress-fill[data-width]').forEach(el => {
        el.style.width = (el.dataset.width||0) + '%';
      });
    }, 100);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function sidebarHTML(active) {
  const user = Auth.getUser();
  const tenant = Auth.getTenant();
  const plan = Auth.getPlan();
  const isAdmin = user?.is_admin;
  const links = isAdmin ? [] : [
    { id:'dashboard', icon:'ğŸ“Š', label:'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', section:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' },
    { id:'projects', icon:'ğŸ—ï¸', label:'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', section:'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©' },
    { id:'workers', icon:'ğŸ‘·', label:'Ø§Ù„Ø¹Ù…Ø§Ù„' },
    { id:'equipment', icon:'ğŸšœ', label:'Ø§Ù„Ù…Ø¹Ø¯Ø§Øª' },
    { id:'attendance', icon:'ğŸ“…', label:'Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨', badge:'Ø¬Ø¯ÙŠØ¯', badgeColor:'rgba(74,144,226,.15)', badgeTextColor:'#60A5FA' },
    { id:'transactions', icon:'ğŸ’°', label:'Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©', section:'Ø§Ù„Ù…Ø§Ù„ÙŠØ©' },
    { id:'reports', icon:'ğŸ“ˆ', label:'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', badge:'Ø¬Ø¯ÙŠØ¯', badgeColor:'rgba(155,109,255,.15)', badgeTextColor:'#9B6DFF' },
    { id:'settings', icon:'âš™ï¸', label:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', section:'Ø§Ù„Ø­Ø³Ø§Ø¨' },
  ];
  let nav = '';
  links.forEach(l => {
    if(l.section) nav += `<div class="nav-section-label">${l.section}</div>`;
    nav += `<button class="nav-link${active===l.id?' active':''}" data-nav="${l.id}">
      <span class="nav-link-icon">${l.icon}</span>${l.label}
      ${l.badge?`<span class="nav-badge" style="background:${l.badgeColor};color:${l.badgeTextColor}">${l.badge}</span>`:''}
    </button>`;
  });
  return `<aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="sidebar-logo-icon">ğŸ—ï¸</div>
      <div><div class="sidebar-logo-text">SmartBTP</div><div class="sidebar-logo-sub">${isAdmin?'Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©':'Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡'}</div></div>
    </div>
    <nav class="sidebar-nav">
      ${isAdmin?`<div class="nav-section-label">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
        <button class="nav-link active"><span class="nav-link-icon">ğŸ¢</span> Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª</button>
        <button class="nav-link" data-nav="landing" style="margin-top:0.5rem"><span class="nav-link-icon">ğŸŒ</span> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      `:nav}
    </nav>
    <div class="sidebar-footer">
      <div class="tenant-chip">
        <div class="tenant-avatar">${isAdmin?'ğŸ‘‘':'ğŸ¢'}</div>
        <div><div class="tenant-name">${escHtml(isAdmin?'Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…':tenant?.name||'Ù…Ø¤Ø³Ø³ØªÙƒ')}</div>
        <div class="tenant-plan">${isAdmin?'Admin':escHtml(plan?.name||'â€”')}</div></div>
      </div>
      <button class="nav-link logout" data-logout><span class="nav-link-icon">ğŸšª</span> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </aside>`;
}

function topbarHTML(breadcrumb) {
  const user = Auth.getUser();
  const initial = (user?.full_name||'U')[0].toUpperCase();
  return `<header class="topbar">
    <div style="display:flex;align-items:center;gap:.8rem">
      <button class="hamburger">â˜°</button>
      <div class="topbar-breadcrumb">SmartBTP <span style="opacity:.3">â€º</span> ${breadcrumb}</div>
    </div>
    <div style="display:flex;align-items:center;gap:.6rem">
      <button class="btn btn-ghost btn-sm" data-nav="landing" style="font-size:.78rem">ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
      <div class="topbar-user">
        <div class="topbar-avatar" title="${escHtml(user?.full_name||'')}">${initial}</div>
        <span style="font-size:.82rem;color:var(--muted)">${escHtml((user?.full_name||'').split(' ')[0])}</span>
      </div>
    </div>
  </header>`;
}

function layoutHTML(active, breadcrumb, content) {
  return `<div class="app-shell">${sidebarHTML(active)}
  <div class="main-wrap">
    ${topbarHTML(breadcrumb)}
    <main class="page-content animate-fade">${content}</main>
    <footer style="padding:.8rem 1.8rem;border-top:1px solid var(--border);display:flex;justify-content:space-between;flex-wrap:wrap;gap:.5rem">
      <span style="font-size:.7rem;color:var(--dim)">Â© 2025 SmartBTP â€” Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</span>
      <span style="font-size:.7rem;color:var(--dim)">v4.0 Pro Edition</span>
    </footer>
  </div></div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const Pages = {};

/* â”€â”€â”€ LANDING PAGE â”€â”€â”€ */
Pages.landing = function() {
  const user = Auth.getUser();
  return `<div class="landing-page">
    <!-- NAVBAR -->
    <nav class="land-nav">
      <div class="land-nav-logo">
        <div class="land-nav-logo-icon">ğŸ—ï¸</div>
        <div class="land-nav-logo-text">SmartBTP</div>
      </div>
      <div class="land-nav-links">
        <a class="land-nav-link" href="#features">Ø§Ù„Ù…ÙŠØ²Ø§Øª</a>
        <a class="land-nav-link" href="#projects">Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</a>
        <a class="land-nav-link" href="#pricing">Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</a>
        <a class="land-nav-link" href="#contact">Ø§Ù„ØªÙˆØ§ØµÙ„</a>
      </div>
      <div class="land-nav-actions">
        ${user
          ? `<button class="btn btn-gold btn-sm" data-nav="${user.is_admin?'admin':'dashboard'}">â†’ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>`
          : `<button class="btn btn-ghost btn-sm" data-nav="login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
             <button class="btn btn-gold btn-sm" data-nav="login">Ø§Ø¨Ø¯Ø£ Ù…Ø¬Ø§Ù†Ø§Ù‹</button>`
        }
      </div>
    </nav>

    <!-- HERO -->
    <section class="hero">
      <div class="hero-bg">
        <div class="hero-bg-img"></div>
        <div class="hero-bg-grid"></div>
        <div class="hero-bg-glow"></div>
      </div>
      <div class="hero-content">
        <div class="hero-badge">ğŸ‡©ğŸ‡¿ Ù…Ù†ØµØ© Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ù‚Ø·Ø§Ø¹ BTP</div>
        <h1 class="hero-title">
          Ø£Ø¯ÙØ± Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡<br>Ø¨ÙƒÙØ§Ø¡Ø© <span>Ø§Ø­ØªØ±Ø§ÙÙŠØ©</span> Ø¹Ø§Ù„ÙŠØ©
        </h1>
        <p class="hero-sub">
          SmartBTP Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© â€” ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ Ø§Ù„Ø¹Ù…Ø§Ù„ØŒ Ø§Ù„Ù…Ø¹Ø¯Ø§ØªØŒ ÙˆØ§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.
        </p>
        <div class="hero-actions">
          <button class="btn btn-gold btn-lg" data-nav="login">ğŸš€ Ø§Ø¨Ø¯Ø£ ØªØ¬Ø±Ø¨ØªÙƒ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</button>
          <button class="btn btn-ghost btn-lg" href="#features">ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠØ²Ø§Øª â†“</button>
        </div>
        <div class="hero-stats">
          <div class="hero-stat"><div class="hero-stat-val">+500</div><div class="hero-stat-label">Ù…Ø¤Ø³Ø³Ø© Ù…Ø´ØªØ±ÙƒØ©</div></div>
          <div class="hero-divider"></div>
          <div class="hero-stat"><div class="hero-stat-val">+2000</div><div class="hero-stat-label">Ù…Ø´Ø±ÙˆØ¹ Ù…ÙØ¯Ø§Ø±</div></div>
          <div class="hero-divider"></div>
          <div class="hero-stat"><div class="hero-stat-val">48</div><div class="hero-stat-label">ÙˆÙ„Ø§ÙŠØ© Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</div></div>
          <div class="hero-divider"></div>
          <div class="hero-stat"><div class="hero-stat-val">99%</div><div class="hero-stat-label">Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div></div>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section class="section" id="features">
      <div class="section-center">
        <div class="section-tag">Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <h2 class="section-title">ÙƒÙ„ Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ</h2>
        <p class="section-sub">Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ ÙŠØºØ·ÙŠ Ø¬Ù…ÙŠØ¹ Ø¬ÙˆØ§Ù†Ø¨ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø­ØªÙ‰ Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</p>
      </div>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon blue">ğŸ—ï¸</div>
          <div class="feature-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
          <div class="feature-desc">ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù… Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ Ø¨Ø´ÙƒÙ„ Ù„Ø­Ø¸ÙŠ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø¨Ø·Ø§Ù‚Ø§Øª Ø°ÙƒÙŠ ÙŠØ¹Ø±Ø¶ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ù†Ø¸Ø±Ø© ÙˆØ§Ø­Ø¯Ø©.</div>
        </div>
        <div class="feature-card">
          <div class="feature-icon gold">ğŸ‘·</div>
          <div class="feature-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„</div>
          <div class="feature-desc">Ø³Ø¬Ù‘Ù„ Ø¹Ù…Ø§Ù„Ùƒ ÙˆØªØªØ¨Ø¹ Ø­Ø¶ÙˆØ±Ù‡Ù… ÙˆØºÙŠØ§Ø¨Ù‡Ù… ÙˆØ±ÙˆØ§ØªØ¨Ù‡Ù… Ù…Ø¹ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨ØµÙŠØºØ© CSV Ø¨Ø¶ØºØ·Ø© ÙˆØ§Ø­Ø¯Ø©.</div>
        </div>
        <div class="feature-card">
          <div class="feature-icon green">ğŸ’°</div>
          <div class="feature-title">Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div>
          <div class="feature-desc">ØªØªØ¨Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ Ù„ÙƒÙ„ Ù…Ø´Ø±ÙˆØ¹ Ù…Ø¹ Ø­Ø³Ø§Ø¨Ø§Øª Ø¢Ù„ÙŠØ© Ù„Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ ÙˆØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©.</div>
        </div>
        <div class="feature-card">
          <div class="feature-icon purple">ğŸšœ</div>
          <div class="feature-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</div>
          <div class="feature-desc">Ø³Ø¬Ù‘Ù„ Ù…Ø¹Ø¯Ø§ØªÙƒ ÙˆÙ…Ø±ÙƒØ¨Ø§ØªÙƒ ÙˆØªØªØ¨Ø¹ Ø­Ø§Ù„ØªÙ‡Ø§ ÙˆØµÙŠØ§Ù†ØªÙ‡Ø§ ÙˆØªÙˆØ²ÙŠØ¹Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©.</div>
        </div>
        <div class="feature-card">
          <div class="feature-icon red">ğŸ“…</div>
          <div class="feature-title">Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</div>
          <div class="feature-desc">Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ø¹ Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆÙ…Ù„ÙØ§Øª Ø§Ù„Ø£Ø¬ÙˆØ± Ø§Ù„Ø´Ù‡Ø±ÙŠØ©.</div>
        </div>
        <div class="feature-card">
          <div class="feature-icon orange">ğŸ“ˆ</div>
          <div class="feature-title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¡</div>
          <div class="feature-desc">ØªÙ‚Ø§Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© ØªÙˆØ¶Ø­ Ø£Ø¯Ø§Ø¡ Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙˆØ§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø±Ø¨Ø­ÙŠØ© Ø¨Ù…Ø±ÙˆØ± Ø§Ù„ÙˆÙ‚Øª.</div>
        </div>
      </div>
    </section>

    <!-- PROJECTS SHOWCASE -->
    <section class="projects-showcase" id="projects">
      <div class="section-center">
        <div class="section-tag" style="background:rgba(52,195,143,0.1);border-color:rgba(52,195,143,0.25);color:#34C38F">Ù…Ø´Ø§Ø±ÙŠØ¹ Ø­Ù‚ÙŠÙ‚ÙŠØ©</div>
        <h2 class="section-title">Ù…Ø´Ø§Ø±ÙŠØ¹ Ø£Ù†Ø¬Ø²Ù‡Ø§ Ø¹Ù…Ù„Ø§Ø¤Ù†Ø§</h2>
        <p class="section-sub">Ù†Ù…Ø§Ø°Ø¬ Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØªÙŠ ÙŠØ¯ÙŠØ±Ù‡Ø§ Ø¹Ù…Ù„Ø§Ø¤Ù†Ø§ Ø¹Ø¨Ø± Ù…Ù†ØµØ© SmartBTP ÙÙŠ Ù…Ø®ØªÙ„Ù Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</p>
      </div>
      <div class="projects-grid">
        <div class="project-img-card">
          <img src="https://images.unsplash.com/photo-1503387762-592deb58ef4e?w=600&q=80" alt="Ù…Ø´Ø±ÙˆØ¹ Ø¨Ù†Ø§Ø¡ Ø¹Ù…Ø§Ø±Ø©">
          <div class="project-img-info">
            <div class="project-img-title">Ø¨Ù†Ø§Ø¡ Ø¹Ù…Ø§Ø±Ø© R+7 â€” Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©</div>
            <div class="project-img-meta">ğŸ“ Ø­ÙŠØ¯Ø±Ø© â€¢ 45,000,000 Ø¯Ø¬ â€¢ ğŸ—ï¸ Ù†Ø´Ø·</div>
          </div>
          <div class="project-img-overlay"><span class="badge badge-active">Ù†Ø´Ø·</span></div>
        </div>
        <div class="project-img-card">
          <img src="https://images.unsplash.com/photo-1582268611958-ebfd161ef9cf?w=600&q=80" alt="Ù…Ø´Ø±ÙˆØ¹ ÙÙŠÙ„Ø§">
          <div class="project-img-info">
            <div class="project-img-title">ÙÙŠÙ„Ø§ Ø³ÙƒÙ†ÙŠØ© ÙØ§Ø®Ø±Ø© â€” Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©</div>
            <div class="project-img-meta">ğŸ“ Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ â€¢ 12,500,000 Ø¯Ø¬ â€¢ âœ… Ù…ÙƒØªÙ…Ù„</div>
          </div>
          <div class="project-img-overlay"><span class="badge badge-completed">Ù…ÙƒØªÙ…Ù„</span></div>
        </div>
        <div class="project-img-card">
          <img src="https://images.unsplash.com/photo-1590859808308-3d2d9c515b1a?w=600&q=80" alt="Ù…Ø´Ø±ÙˆØ¹ ØªØ¬Ø§Ø±ÙŠ">
          <div class="project-img-info">
            <div class="project-img-title">Ù…Ø³ØªÙˆØ¯Ø¹ ØªØ¬Ø§Ø±ÙŠ ØµÙ†Ø§Ø¹ÙŠ â€” ÙˆÙ‡Ø±Ø§Ù†</div>
            <div class="project-img-meta">ğŸ“ ÙˆÙ‡Ø±Ø§Ù† â€¢ 22,000,000 Ø¯Ø¬ â€¢ ğŸ—ï¸ Ù†Ø´Ø·</div>
          </div>
          <div class="project-img-overlay"><span class="badge badge-active">Ù†Ø´Ø·</span></div>
        </div>
      </div>
    </section>

    <!-- HOW IT WORKS -->
    <section class="section" style="background:rgba(255,255,255,0.01)">
      <div class="section-center">
        <div class="section-tag" style="background:rgba(155,109,255,0.1);border-color:rgba(155,109,255,0.25);color:#9B6DFF">ÙƒÙŠÙ ÙŠØ¹Ù…Ù„</div>
        <h2 class="section-title">Ø§Ø¨Ø¯Ø£ Ø®Ù„Ø§Ù„ 3 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙ‚Ø·</h2>
        <p class="section-sub">Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø³ÙŠØ· ÙˆØ³Ø±ÙŠØ¹ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ Ø®Ø¨Ø±Ø© ØªÙ‚Ù†ÙŠØ©</p>
      </div>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem;max-width:900px;margin:0 auto;text-align:center">
        ${[
          {n:'01',icon:'ğŸ“',t:'Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ',d:'Ø³Ø¬Ù‘Ù„ Ù…Ø¤Ø³Ø³ØªÙƒ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø³ÙŠØ·Ø© ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†'},
          {n:'02',icon:'ğŸ—ï¸',t:'Ø£Ø¶Ù Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ',d:'Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ Ù…Ø¹ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ù…Ø±Ø§Ø­Ù„'},
          {n:'03',icon:'ğŸ“Š',t:'ØªØ§Ø¨Ø¹ ÙˆØªØ­ÙƒÙ…',d:'Ø±Ø§Ù‚Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù… ÙˆØ£Ø¯Ø± Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙˆØµØ¯Ù‘Ø± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª'},
        ].map(s=>`<div style="padding:2rem 1.5rem;background:rgba(255,255,255,0.025);border:1px solid var(--border);border-radius:20px;position:relative;transition:all 0.3s" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform=''">
          <div style="position:absolute;top:-1px;right:50%;transform:translateX(50%);background:linear-gradient(135deg,#E8B84B,#C49030);color:#09120A;font-size:.7rem;font-weight:900;padding:.2rem .8rem;border-radius:0 0 10px 10px;font-family:'JetBrains Mono',monospace">${s.n}</div>
          <div style="font-size:2.5rem;margin-bottom:1rem;margin-top:.5rem">${s.icon}</div>
          <div style="font-size:1rem;font-weight:800;margin-bottom:.5rem">${s.t}</div>
          <div style="font-size:.85rem;color:var(--muted)">${s.d}</div>
        </div>`).join('')}
      </div>
    </section>

    <!-- PRICING -->
    <section class="pricing-section" id="pricing">
      <div class="section-center">
        <div class="section-tag">Ø®Ø·Ø· Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</div>
        <h2 class="section-title">Ø£Ø³Ø¹Ø§Ø± ØªÙ†Ø§Ø³Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª</h2>
        <p class="section-sub">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø­Ø¬Ù… Ù…Ø¤Ø³Ø³ØªÙƒ â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø·Ø· ØªØ´Ù…Ù„ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</p>
      </div>
      <div class="pricing-grid">
        <div class="pricing-card">
          <div class="pricing-name">Ø§Ù„Ù…Ø¨ØªØ¯Ø¦</div>
          <div class="pricing-price">2,900<span> Ø¯Ø¬</span></div>
          <div class="pricing-period">/ Ø´Ù‡Ø±ÙŠØ§Ù‹ â€” Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ† Ø§Ù„Ø£ÙØ±Ø§Ø¯</div>
          <ul class="pricing-features">
            <li><span class="check">âœ“</span> 3 Ù…Ø´Ø§Ø±ÙŠØ¹ Ù†Ø´Ø·Ø©</li>
            <li><span class="check">âœ“</span> 15 Ø¹Ø§Ù…Ù„ ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰</li>
            <li><span class="check">âœ“</span> Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¶ÙˆØ±</li>
            <li><span class="check">âœ“</span> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</li>
            <li><span class="x">â€”</span> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</li>
            <li><span class="x">â€”</span> Ø¯Ø¹Ù… API</li>
          </ul>
          <button class="btn btn-ghost" style="width:100%;justify-content:center" data-nav="login">Ø§Ø¨Ø¯Ø£ Ù…Ø¬Ø§Ù†Ø§Ù‹</button>
        </div>
        <div class="pricing-card popular">
          <div class="pricing-popular-badge">â­ Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</div>
          <div class="pricing-name">Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</div>
          <div class="pricing-price">7,900<span> Ø¯Ø¬</span></div>
          <div class="pricing-period">/ Ø´Ù‡Ø±ÙŠØ§Ù‹ â€” Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·Ø©</div>
          <ul class="pricing-features">
            <li><span class="check">âœ“</span> 20 Ù…Ø´Ø±ÙˆØ¹ Ù†Ø´Ø·</li>
            <li><span class="check">âœ“</span> 100 Ø¹Ø§Ù…Ù„</li>
            <li><span class="check">âœ“</span> 50 Ù…Ø¹Ø¯Ø©</li>
            <li><span class="check">âœ“</span> ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªÙ‚Ø¯Ù…Ø©</li>
            <li><span class="check">âœ“</span> ØªØµØ¯ÙŠØ± CSV ÙˆPDF</li>
            <li><span class="check">âœ“</span> Ø¯Ø¹Ù… Ø°Ùˆ Ø£ÙˆÙ„ÙˆÙŠØ©</li>
          </ul>
          <button class="btn btn-gold" style="width:100%;justify-content:center" data-nav="login">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</button>
        </div>
        <div class="pricing-card">
          <div class="pricing-name">Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ</div>
          <div class="pricing-price">19,900<span> Ø¯Ø¬</span></div>
          <div class="pricing-period">/ Ø´Ù‡Ø±ÙŠØ§Ù‹ â€” Ù„Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¨Ù„Ø§ Ø­Ø¯ÙˆØ¯</div>
          <ul class="pricing-features">
            <li><span class="check">âœ“</span> Ù…Ø´Ø§Ø±ÙŠØ¹ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li>
            <li><span class="check">âœ“</span> Ø¹Ù…Ø§Ù„ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯ÙˆÙ†</li>
            <li><span class="check">âœ“</span> Ù…Ø¹Ø¯Ø§Øª ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li>
            <li><span class="check">âœ“</span> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</li>
            <li><span class="check">âœ“</span> API ÙƒØ§Ù…Ù„</li>
            <li><span class="check">âœ“</span> Ø¯Ø¹Ù… Ù…Ø®ØµØµ Ø¹Ù„Ù‰ Ù…Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ø¹Ø©</li>
          </ul>
          <button class="btn btn-outline-gold" style="width:100%;justify-content:center" data-nav="login">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</button>
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="cta-section" id="contact">
      <div class="cta-box">
        <div style="font-size:3rem;margin-bottom:1rem;animation:floatUp 3s ease infinite">ğŸ—ï¸</div>
        <h2 class="cta-title">Ø§Ø¨Ø¯Ø£ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ Ø§Ù„ÙŠÙˆÙ…</h2>
        <p class="cta-sub">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ø£ÙƒØ«Ø± Ù…Ù† 500 Ù…Ø¤Ø³Ø³Ø© Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© ØªØ³ØªØ®Ø¯Ù… SmartBTP Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹Ù‡Ø§ Ø¨ÙƒÙØ§Ø¡Ø© ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©</p>
        <div style="display:flex;align-items:center;justify-content:center;gap:1rem;flex-wrap:wrap">
          <button class="btn btn-gold btn-lg" data-nav="login">ğŸš€ Ø§Ø¨Ø¯Ø£ ØªØ¬Ø±Ø¨ØªÙƒ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</button>
          <button class="btn btn-ghost btn-lg">ğŸ“ Ø§ØªØµÙ„ Ø¨Ù†Ø§</button>
        </div>
        <div style="margin-top:1.5rem;font-size:0.8rem;color:var(--dim)">âœ… Ù„Ø§ ÙŠÙ„Ø²Ù… Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù† &nbsp;â€¢&nbsp; âœ… Ø¥Ù„ØºØ§Ø¡ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª &nbsp;â€¢&nbsp; âœ… Ø¯Ø¹Ù… Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer class="land-footer">
      <div class="land-footer-logo">
        <div class="land-nav-logo-icon" style="width:30px;height:30px;font-size:0.9rem">ğŸ—ï¸</div>
        <div style="font-weight:900;color:var(--gold);font-size:0.9rem">SmartBTP</div>
      </div>
      <div class="land-footer-text">Â© 2025 SmartBTP â€” Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</div>
      <div style="display:flex;gap:.5rem">
        <button class="btn btn-ghost btn-sm" data-nav="login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </div>
    </footer>
  </div>`;
};

/* â”€â”€â”€ LOGIN PAGE â”€â”€â”€ */
Pages.login = function() {
  return `<div class="login-page">
    <button class="login-back-btn" data-nav="landing">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</button>
    <div class="login-wrap">
      <!-- Left Panel -->
      <div class="login-left">
        <div class="login-left-bg"></div>
        <div class="login-left-overlay"></div>
        <div class="login-left-content">
          <div class="login-left-logo">
            <div class="login-left-logo-icon">ğŸ—ï¸</div>
            <div class="login-left-logo-text">SmartBTP</div>
          </div>
          <div class="login-left-title">Ø£Ø¯ÙØ± Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ<br>Ø¨Ø§Ø­ØªØ±Ø§ÙÙŠØ©</div>
          <div class="login-left-sub">Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© â€” Ù…ØªÙƒØ§Ù…Ù„Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</div>
          <div class="login-left-features">
            <div class="login-left-feat"><div class="login-left-feat-icon">ğŸ—ï¸</div> Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ù„Ø­Ø¸ÙŠØ§Ù‹</div>
            <div class="login-left-feat"><div class="login-left-feat-icon">ğŸ‘·</div> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ø­Ø¶ÙˆØ±</div>
            <div class="login-left-feat"><div class="login-left-feat-icon">ğŸ’°</div> Ù…Ø­Ø§Ø³Ø¨Ø© Ù…Ø§Ù„ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø©</div>
            <div class="login-left-feat"><div class="login-left-feat-icon">ğŸ“ˆ</div> ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ¥Ø­ØµØ§Ø¡Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©</div>
            <div class="login-left-feat"><div class="login-left-feat-icon">ğŸ”’</div> Ø¨ÙŠØ§Ù†Ø§Øª Ø¢Ù…Ù†Ø© ÙˆÙ…Ø´ÙØ±Ø©</div>
          </div>
        </div>
      </div>
      <!-- Right Panel -->
      <div class="login-right">
        <div class="login-right-logo">
          <div style="font-size:1.4rem;font-weight:900;color:var(--gold)">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</div>
        </div>
        <div class="login-right-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
        <div class="login-right-sub">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
        <div class="login-tabs">
          <button class="login-tab active" id="tabTenant" onclick="switchTab('tenant')">ğŸ¢ Ù…Ø¤Ø³Ø³Ø©</button>
          <button class="login-tab" id="tabAdmin" onclick="switchTab('admin')">ğŸ‘‘ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
        </div>
        <div id="loginError" style="display:none" class="alert alert-error">âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
        <div class="form-group">
          <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input class="form-input" id="loginEmail" type="email" placeholder="example@company.dz" dir="ltr">
        </div>
        <div class="form-group">
          <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <div style="position:relative">
            <input class="form-input" id="loginPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" dir="ltr" style="padding-left:2.5rem">
            <button onclick="togglePass()" style="position:absolute;left:.6rem;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--dim);font-size:1rem">ğŸ‘ï¸</button>
          </div>
        </div>
        <button class="btn btn-gold" style="width:100%;justify-content:center;padding:.85rem;font-size:1rem;margin-top:.5rem" onclick="doLogin()">
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ â†’
        </button>
        <div class="login-demo-box">
          <div class="login-demo-title">Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
          <div class="login-demo-row">ğŸ‘‘ Ù…Ø³Ø¤ÙˆÙ„: <span dir="ltr" style="color:var(--gold);font-family:monospace;font-size:.75rem">admin@smartbtp.dz / Admin@SmartBTP2025</span></div>
          <div class="login-demo-row">ğŸ¢ Ù…Ø¤Ø³Ø³Ø©: <span dir="ltr" style="color:var(--blue);font-family:monospace;font-size:.75rem">demo@algerie-construction.dz / Demo@1234</span></div>
        </div>
      </div>
    </div>
  </div>`;
};

/* â”€â”€â”€ DASHBOARD â”€â”€â”€ */
Pages.dashboard = function() {
  const user = Auth.getUser();
  const tid = user.tenant_id;
  const projects = DB.get('projects').filter(p => p.tenant_id===tid && !p.is_archived);
  const workers  = DB.get('workers').filter(w => w.tenant_id===tid);
  const equip    = DB.get('equipment').filter(e => e.tenant_id===tid);
  const txs      = DB.get('transactions').filter(t => t.tenant_id===tid);
  const revenue  = txs.filter(t=>t.type==='revenue').reduce((s,t)=>s+Number(t.amount),0);
  const expense  = txs.filter(t=>t.type==='expense').reduce((s,t)=>s+Number(t.amount),0);
  const totalBudget = projects.reduce((s,p)=>s+Number(p.budget),0);
  const totalSpent  = projects.reduce((s,p)=>s+Number(p.total_spent),0);
  const recent = [...projects].sort((a,b)=>b.id-a.id).slice(0,4);
  const plan = Auth.getPlan();

  return layoutHTML('dashboard','Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',`
    <div class="page-header">
      <div><div class="page-title">ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ØŒ ${escHtml(user.full_name.split(' ')[0])}</div>
        <div class="page-sub">${new Date().toLocaleDateString('ar-DZ',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}</div>
      </div>
      <div class="page-actions">
        <span style="font-size:.78rem;background:rgba(52,195,143,.1);border:1px solid rgba(52,195,143,.2);border-radius:8px;padding:5px 12px;color:#34C38F;font-weight:700">âœ… ${plan?.name||''}</span>
        <button class="btn btn-gold btn-sm" data-nav="projects">+ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</button>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-icon">ğŸ—ï¸</div><div class="stat-value" style="color:var(--blue)">${projects.filter(p=>p.status==='active').length}</div><div class="stat-label">Ù…Ø´Ø§Ø±ÙŠØ¹ Ù†Ø´Ø·Ø©</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸ‘·</div><div class="stat-value" style="color:var(--green)">${workers.length}</div><div class="stat-label">Ø¹Ù…Ø§Ù„ Ù…Ø³Ø¬Ù„ÙˆÙ†</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸšœ</div><div class="stat-value" style="color:var(--purple)">${equip.length}</div><div class="stat-label">Ù…Ø¹Ø¯Ø§Øª</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸ’°</div><div class="stat-value" style="color:${revenue-expense>=0?'var(--green)':'var(--red)'};font-size:1.1rem">${fmt(revenue-expense)}</div><div class="stat-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (Ø¯Ø¬)</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸ“Š</div><div class="stat-value" style="color:var(--gold)">${totalBudget>0?Math.round(totalSpent/totalBudget*100):0}%</div><div class="stat-label">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</div><div class="progress-bar" style="margin-top:.5rem"><div class="progress-fill" style="background:var(--gold)" data-width="${totalBudget>0?Math.min(Math.round(totalSpent/totalBudget*100),100):0}"></div></div></div>
      <div class="stat-card"><div class="stat-icon">âœ…</div><div class="stat-value" style="color:var(--green)">${projects.filter(p=>p.status==='completed').length}</div><div class="stat-label">Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙƒØªÙ…Ù„Ø©</div></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem">
      <div class="card">
        <div style="font-size:.9rem;font-weight:800;margin-bottom:1rem">ğŸ’° Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ</div>
        <div style="display:flex;justify-content:space-between;padding:.6rem 0;border-bottom:1px solid var(--border)">
          <span style="color:var(--dim);font-size:.84rem">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</span>
          <span style="color:var(--green);font-weight:700;font-family:monospace">${fmt(revenue)} Ø¯Ø¬</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.6rem 0;border-bottom:1px solid var(--border)">
          <span style="color:var(--dim);font-size:.84rem">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</span>
          <span style="color:var(--red);font-weight:700;font-family:monospace">${fmt(expense)} Ø¯Ø¬</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding:.6rem 0">
          <span style="color:var(--dim);font-size:.84rem">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ</span>
          <span style="color:${revenue-expense>=0?'var(--green)':'var(--red)'};font-weight:900;font-family:monospace">${fmt(revenue-expense)} Ø¯Ø¬</span>
        </div>
      </div>
      <div class="card">
        <div style="font-size:.9rem;font-weight:800;margin-bottom:1rem">ğŸ—ï¸ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
        ${['active','completed','delayed'].map(s=>{
          const cnt=projects.filter(p=>p.status===s).length;
          const pct=projects.length?Math.round(cnt/projects.length*100):0;
          const col=s==='active'?'var(--green)':s==='completed'?'var(--blue)':'var(--red)';
          return `<div style="margin-bottom:.7rem"><div style="display:flex;justify-content:space-between;font-size:.78rem;margin-bottom:4px"><span style="color:var(--muted)">${statusLabel(s)}</span><span style="color:${col};font-weight:700">${cnt}</span></div><div class="progress-bar"><div class="progress-fill" style="background:${col}" data-width="${pct}"></div></div></div>`;
        }).join('')}
      </div>
    </div>
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
        <div style="font-size:.9rem;font-weight:800">ğŸ—ï¸ Ø¢Ø®Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
        <button class="btn btn-ghost btn-sm" data-nav="projects">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†</button>
      </div>
      <div class="grid-cards">
        ${recent.map(p=>`
          <div style="background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.07);border-radius:14px;overflow:hidden;transition:all .2s" onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform=''">
            <div style="height:3px;background:${p.color}"></div>
            <div style="padding:1rem">
              <div style="font-weight:800;font-size:.9rem;margin-bottom:.3rem">${escHtml(p.name)}</div>
              <div style="font-size:.75rem;color:var(--dim);margin-bottom:.7rem">${escHtml(p.wilaya||'')} ${p.client_name?'â€¢ '+escHtml(p.client_name):''}</div>
              <div style="display:flex;justify-content:space-between;margin-bottom:.4rem"><span style="font-size:.75rem;color:var(--dim)">Ø§Ù„ØªÙ‚Ø¯Ù…</span><span style="font-size:.75rem;font-weight:700">${p.progress}%</span></div>
              <div class="progress-bar"><div class="progress-fill" style="background:${p.color}" data-width="${p.progress}"></div></div>
              <div style="margin-top:.7rem">${statusBadge(p.status)}</div>
            </div>
          </div>`).join('')||'<div class="empty"><div class="empty-icon">ğŸ—ï¸</div><div class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø¹Ø¯</div></div>'}
      </div>
    </div>
  `);
};

/* â”€â”€â”€ PROJECTS â”€â”€â”€ */
Pages.projects = function() {
  const tid = Auth.getUser().tenant_id;
  const plan = Auth.getPlan();
  const projects = DB.get('projects').filter(p=>p.tenant_id===tid && !p.is_archived);
  const workers  = DB.get('workers');
  const total=projects.length, active=projects.filter(p=>p.status==='active').length;
  const completed=projects.filter(p=>p.status==='completed').length, delayed=projects.filter(p=>p.status==='delayed').length;

  const cards = projects.map(p=>{
    const wCount=workers.filter(w=>w.project_id===p.id).length;
    return `<div style="background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.07);border-radius:16px;overflow:hidden;transition:all .28s cubic-bezier(.34,1.56,.64,1)" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform=''">
      <div style="height:3px;background:${p.color}"></div>
      <div style="padding:1.1rem 1.2rem">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.5rem">
          <div style="font-weight:800;font-size:.95rem;flex:1">${escHtml(p.name)}</div>${statusBadge(p.status)}
        </div>
        <div style="display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:.8rem">
          ${p.wilaya?`<span style="font-size:.72rem;color:var(--dim)">ğŸ“ ${escHtml(p.wilaya)}</span>`:''}
          ${p.client_name?`<span style="font-size:.72rem;color:var(--dim)">ğŸ‘¤ ${escHtml(p.client_name)}</span>`:''}
          ${wCount?`<span style="font-size:.72rem;color:var(--dim)">ğŸ‘· ${wCount}</span>`:''}
        </div>
        <div style="display:flex;justify-content:space-between;font-size:.75rem;margin-bottom:4px"><span style="color:var(--dim)">Ø§Ù„ØªÙ‚Ø¯Ù…</span><span style="font-weight:700">${p.progress}%</span></div>
        <div class="progress-bar" style="margin-bottom:.8rem"><div class="progress-fill" style="background:${p.color}" data-width="${p.progress}"></div></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:.4rem;font-size:.75rem;margin-bottom:.8rem">
          <div><div style="color:var(--dim)">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</div><div style="font-weight:700;font-family:monospace">${fmt(p.budget)}</div></div>
          <div><div style="color:var(--dim)">Ø§Ù„Ù…ÙÙ†ÙÙÙ‚</div><div style="font-weight:700;color:${p.total_spent>p.budget?'var(--red)':'var(--green)'};font-family:monospace">${fmt(p.total_spent)}</div></div>
        </div>
        <div style="display:flex;gap:.4rem">
          <button class="btn btn-blue btn-sm" style="flex:1" onclick="editProject(${p.id})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn btn-red btn-sm" onclick="deleteProject(${p.id},'${escHtml(p.name)}')">ğŸ—‘ï¸</button>
        </div>
      </div>
    </div>`;
  }).join('')||`<div class="empty" style="grid-column:1/-1"><div class="empty-icon">ğŸ—ï¸</div><div class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¨Ø¹Ø¯</div><div class="empty-text">Ø£Ø¶Ù Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø¨Ø¯Ø¡</div></div>`;

  return layoutHTML('projects','Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',`
    <div class="page-header">
      <div><div class="page-title">ğŸ—ï¸ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="page-sub">${total} Ù…Ø´Ø±ÙˆØ¹</div></div>
      <div class="page-actions"><button class="btn btn-gold" data-modal-open="addProjectModal">+ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</button></div>
    </div>
    <div class="stats-grid" style="grid-template-columns:repeat(4,1fr)">
      <div class="stat-card"><div class="stat-value" style="color:var(--blue)">${total}</div><div class="stat-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--green)">${active}</div><div class="stat-label">Ù†Ø´Ø·Ø©</div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--blue)">${completed}</div><div class="stat-label">Ù…ÙƒØªÙ…Ù„Ø©</div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--red)">${delayed}</div><div class="stat-label">Ù…ØªØ£Ø®Ø±Ø©</div></div>
    </div>
    <div class="grid-cards">${cards}</div>
    <div class="modal-overlay" id="addProjectModal">
      <div class="modal modal-lg">
        <div class="modal-title">ğŸ—ï¸ Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</div>
        <div class="form-grid-2">
          <div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ *</label><input class="form-input" id="pName" placeholder="Ø¨Ù†Ø§Ø¡ Ø¹Ù…Ø§Ø±Ø©..."></div>
          <div class="form-group"><label class="form-label">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label><select class="form-select" id="pWilaya"><option value="">Ø§Ø®ØªØ±...</option>${WILAYAS.map(w=>`<option>${w}</option>`).join('')}</select></div>
          <div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input class="form-input" id="pClient" placeholder="Ø¹Ø¨Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ø±..."></div>
          <div class="form-group"><label class="form-label">Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input class="form-input" id="pPhone" placeholder="0550..."></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø¯Ø¬)</label><input class="form-input" id="pBudget" type="number" placeholder="0"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label><select class="form-select" id="pPhase"><option value="">Ø§Ø®ØªØ±...</option>${PHASES.map(ph=>`<option>${ph}</option>`).join('')}</select></div>
          <div class="form-group"><label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label><input class="form-input" id="pStart" type="date"></div>
          <div class="form-group"><label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input class="form-input" id="pEnd" type="date"></div>
        </div>
        <div class="form-group"><label class="form-label">Ø§Ù„ÙˆØµÙ</label><textarea class="form-textarea" id="pDesc"></textarea></div>
        <div class="form-group"><label class="form-label">Ø§Ù„Ù„ÙˆÙ†</label><input type="hidden" id="pColor" value="#4A90E2"><div class="color-options">${COLORS.map((c,i)=>`<div class="color-option${i===0?' selected':''}" style="background:${c}" data-color="${c}" data-target="pColor"></div>`).join('')}</div></div>
        <div class="modal-footer"><button class="btn btn-ghost" data-modal-close>Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-gold" onclick="addProject()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button></div>
      </div>
    </div>
    <div class="modal-overlay" id="editProjectModal">
      <div class="modal modal-lg">
        <div class="modal-title">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div><input type="hidden" id="epId">
        <div class="form-grid-2">
          <div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><input class="form-input" id="epName"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label><select class="form-select" id="epWilaya"><option value="">Ø§Ø®ØªØ±...</option>${WILAYAS.map(w=>`<option>${w}</option>`).join('')}</select></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label><select class="form-select" id="epStatus"><option value="active">Ù†Ø´Ø·</option><option value="completed">Ù…ÙƒØªÙ…Ù„</option><option value="delayed">Ù…ØªØ£Ø®Ø±</option><option value="paused">Ù…ØªÙˆÙ‚Ù</option></select></div>
          <div class="form-group"><label class="form-label">Ø§Ù„ØªÙ‚Ø¯Ù… %</label><input class="form-input" id="epProgress" type="number" min="0" max="100"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© (Ø¯Ø¬)</label><input class="form-input" id="epBudget" type="number"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</label><select class="form-select" id="epPhase"><option value="">Ø§Ø®ØªØ±...</option>${PHASES.map(ph=>`<option>${ph}</option>`).join('')}</select></div>
          <div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input class="form-input" id="epClient"></div>
          <div class="form-group"><label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label><input class="form-input" id="epEnd" type="date"></div>
        </div>
        <div class="modal-footer"><button class="btn btn-ghost" data-modal-close>Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-gold" onclick="saveProject()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button></div>
      </div>
    </div>
  `);
};

/* â”€â”€â”€ WORKERS â”€â”€â”€ */
Pages.workers = function() {
  const tid = Auth.getUser().tenant_id;
  const workers  = DB.get('workers').filter(w=>w.tenant_id===tid);
  const projects = DB.get('projects').filter(p=>p.tenant_id===tid && !p.is_archived);
  const plan = Auth.getPlan();
  const maxW = plan?.max_workers||-1;
  const pct = maxW>0?Math.min(Math.round(workers.length/maxW*100),100):0;
  const rows = workers.map(w=>{
    const proj=projects.find(p=>p.id===w.project_id);
    const typeLabel={daily:'ÙŠÙˆÙ…ÙŠ',monthly:'Ø´Ù‡Ø±ÙŠ',seasonal:'Ù…ÙˆØ³Ù…ÙŠ',contract:'Ù…Ù‚Ø§ÙˆÙ„'}[w.contract_type]||w.contract_type;
    return `<tr>
      <td><div style="display:flex;align-items:center;gap:.7rem"><div style="width:36px;height:36px;border-radius:50%;background:${w.color||'#4A90E2'};display:flex;align-items:center;justify-content:center;font-weight:900;color:#fff;font-size:.8rem">${(w.full_name||'?')[0]}</div><div><div style="font-weight:700">${escHtml(w.full_name)}</div><div style="font-size:.72rem;color:var(--dim)">ğŸ“ ${escHtml(w.phone||'')}</div></div></div></td>
      <td>${escHtml(w.role)}</td>
      <td style="color:var(--dim);font-size:.82rem">${escHtml(proj?.name||'â€”')}</td>
      <td><span style="font-weight:700;font-family:monospace">${fmt(w.daily_salary)}</span> <span style="font-size:.72rem;color:var(--dim)">Ø¯Ø¬</span></td>
      <td><span class="badge" style="background:rgba(74,144,226,.1);color:#60A5FA;border:1px solid rgba(74,144,226,.2)">${typeLabel}</span></td>
      <td style="color:var(--dim);font-size:.82rem">${fmtDate(w.hire_date)}</td>
      <td><div style="display:flex;gap:.3rem"><button class="btn btn-blue btn-sm" onclick="editWorker(${w.id})">âœï¸</button><button class="btn btn-red btn-sm" onclick="deleteWorker(${w.id},'${escHtml(w.full_name)}')">ğŸ—‘ï¸</button></div></td>
    </tr>`;
  }).join('');

  return layoutHTML('workers','Ø§Ù„Ø¹Ù…Ø§Ù„',`
    <div class="page-header">
      <div><div class="page-title">ğŸ‘· Ø§Ù„Ø¹Ù…Ø§Ù„</div><div class="page-sub">${workers.length} Ø¹Ø§Ù…Ù„</div></div>
      <div class="page-actions">
        <button class="btn btn-ghost btn-sm" onclick="exportWorkers()">ğŸ“¥ ØªØµØ¯ÙŠØ± CSV</button>
        <button class="btn btn-gold" data-modal-open="addWorkerModal">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„</button>
      </div>
    </div>
    ${maxW>0?`<div style="background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:var(--radius);padding:.85rem 1rem;margin-bottom:1rem;display:flex;align-items:center;gap:1rem">
      <span style="font-size:.78rem;color:var(--muted);font-weight:700;white-space:nowrap">Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ÙŠØ©:</span>
      <div style="flex:1;height:5px;border-radius:3px;background:rgba(255,255,255,.07);overflow:hidden"><div style="height:100%;border-radius:3px;background:${pct>=90?'var(--red)':pct>=70?'var(--gold)':'var(--green)'};width:${pct}%"></div></div>
      <span style="font-size:.76rem;color:var(--dim);font-family:monospace">${workers.length}/${maxW}</span></div>`:''}
    ${workers.length?`<div class="table-wrap"><table>
      <thead><tr><th>Ø§Ù„Ø¹Ø§Ù…Ù„</th><th>Ø§Ù„Ù…Ù‡Ù†Ø©</th><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ</th><th>Ø§Ù„Ø¹Ù‚Ø¯</th><th>Ø§Ù„ØªØ¹ÙŠÙŠÙ†</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
      <tbody>${rows}</tbody></table></div>`:`<div class="empty"><div class="empty-icon">ğŸ‘·</div><div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ø§Ù„</div></div>`}
    <div class="modal-overlay" id="addWorkerModal">
      <div class="modal">
        <div class="modal-title">ğŸ‘· Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ù…Ù„ Ø¬Ø¯ÙŠØ¯</div>
        <div class="form-grid-2">
          <div class="form-group"><label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label><input class="form-input" id="wName" placeholder="Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ù…ÙŠÙ†..."></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ù‡Ù†Ø© *</label><input class="form-input" id="wRole" placeholder="Ø¨Ù†Ù‘Ø§Ø¡ØŒ Ø­Ø¯Ø§Ø¯..."></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù‡Ø§ØªÙ</label><input class="form-input" id="wPhone" placeholder="0550..."></div>
          <div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label><input class="form-input" id="wNid"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ (Ø¯Ø¬)</label><input class="form-input" id="wSalary" type="number" placeholder="3000"></div>
          <div class="form-group"><label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯</label><select class="form-select" id="wContract"><option value="daily">ÙŠÙˆÙ…ÙŠ</option><option value="monthly">Ø´Ù‡Ø±ÙŠ</option><option value="seasonal">Ù…ÙˆØ³Ù…ÙŠ</option><option value="contract">Ù…Ù‚Ø§ÙˆÙ„</option></select></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><select class="form-select" id="wProject"><option value="">Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø±ÙˆØ¹</option>${projects.map(p=>`<option value="${p.id}">${escHtml(p.name)}</option>`).join('')}</select></div>
          <div class="form-group"><label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label><input class="form-input" id="wHire" type="date"></div>
        </div>
        <div class="form-group"><label class="form-label">Ø§Ù„Ù„ÙˆÙ†</label><input type="hidden" id="wColor" value="#4A90E2"><div class="color-options">${COLORS.map((c,i)=>`<div class="color-option${i===0?' selected':''}" style="background:${c}" data-color="${c}" data-target="wColor"></div>`).join('')}</div></div>
        <div class="modal-footer"><button class="btn btn-ghost" data-modal-close>Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-gold" onclick="addWorker()">ğŸ’¾ Ø­ÙØ¸</button></div>
      </div>
    </div>
    <div class="modal-overlay" id="editWorkerModal">
      <div class="modal">
        <div class="modal-title">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ù„</div><input type="hidden" id="ewId">
        <div class="form-grid-2">
          <div class="form-group"><label class="form-label">Ø§Ù„Ø§Ø³Ù…</label><input class="form-input" id="ewName"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ù‡Ù†Ø©</label><input class="form-input" id="ewRole"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù‡Ø§ØªÙ</label><input class="form-input" id="ewPhone"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ</label><input class="form-input" id="ewSalary" type="number"></div>
          <div class="form-group"><label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯</label><select class="form-select" id="ewContract"><option value="daily">ÙŠÙˆÙ…ÙŠ</option><option value="monthly">Ø´Ù‡Ø±ÙŠ</option><option value="seasonal">Ù…ÙˆØ³Ù…ÙŠ</option><option value="contract">Ù…Ù‚Ø§ÙˆÙ„</option></select></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><select class="form-select" id="ewProject"><option value="">Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø±ÙˆØ¹</option>${projects.map(p=>`<option value="${p.id}">${escHtml(p.name)}</option>`).join('')}</select></div>
        </div>
        <div class="modal-footer"><button class="btn btn-ghost" data-modal-close>Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-gold" onclick="saveWorker()">ğŸ’¾ Ø­ÙØ¸</button></div>
      </div>
    </div>
  `);
};

/* â”€â”€â”€ EQUIPMENT â”€â”€â”€ */
Pages.equipment = function() {
  const tid = Auth.getUser().tenant_id;
  const equip = DB.get('equipment').filter(e=>e.tenant_id===tid);
  const projects = DB.get('projects').filter(p=>p.tenant_id===tid && !p.is_archived);
  const statusMap = { active:{label:'Ù†Ø´Ø·',col:'var(--green)'}, maintenance:{label:'ØµÙŠØ§Ù†Ø©',col:'var(--gold)'}, idle:{label:'Ø®Ø§Ù…Ù„',col:'var(--dim)'} };
  const cards = equip.map(e=>{
    const proj=projects.find(p=>p.id===e.project_id);
    const st=statusMap[e.status]||statusMap.idle;
    return `<div class="card" style="position:relative">
      <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem">
        <div style="width:52px;height:52px;border-radius:14px;background:rgba(232,184,75,.1);border:1px solid rgba(232,184,75,.2);display:flex;align-items:center;justify-content:center;font-size:1.8rem">${e.icon||'ğŸšœ'}</div>
        <div><div style="font-weight:800">${escHtml(e.name)}</div><div style="font-size:.75rem;color:var(--dim)">${escHtml(e.model||'')}</div></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;font-size:.78rem;margin-bottom:.8rem">
        <div><div style="color:var(--dim)">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</div><div style="font-weight:600">${escHtml(proj?.name||'â€”')}</div></div>
        <div><div style="color:var(--dim)">Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</div><div style="font-weight:600;font-family:monospace;direction:ltr;text-align:right">${escHtml(e.plate_number||'â€”')}</div></div>
        <div><div style="color:var(--dim)">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</div><div style="font-weight:600;font-family:monospace">${fmt(e.purchase_price)} Ø¯Ø¬</div></div>
        <div><div style="color:var(--dim)">Ø§Ù„Ø­Ø§Ù„Ø©</div>
          <select class="form-select" style="padding:.2rem .5rem;font-size:.75rem;margin-top:2px" onchange="updateEquipStatus(${e.id},this.value)">
            ${Object.entries(statusMap).map(([k,v])=>`<option value="${k}"${e.status===k?' selected':''}>${v.label}</option>`).join('')}
          </select>
        </div>
      </div>
      <button class="btn btn-red btn-sm" onclick="deleteEquip(${e.id},'${escHtml(e.name)}')" style="width:100%;justify-content:center">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    </div>`;
  }).join('')||`<div class="empty" style="grid-column:1/-1"><div class="empty-icon">ğŸšœ</div><div class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø¯Ø§Øª</div></div>`;

  return layoutHTML('equipment','Ø§Ù„Ù…Ø¹Ø¯Ø§Øª',`
    <div class="page-header">
      <div><div class="page-title">ğŸšœ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª</div><div class="page-sub">${equip.length} Ù…Ø¹Ø¯Ø© Ù…Ø³Ø¬Ù„Ø©</div></div>
      <div class="page-actions"><button class="btn btn-gold" data-modal-open="addEquipModal">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø¯Ø©</button></div>
    </div>
    <div class="stats-grid" style="grid-template-columns:repeat(3,1fr)">
      <div class="stat-card"><div class="stat-value" style="color:var(--green)">${equip.filter(e=>e.status==='active').length}</div><div class="stat-label">Ù†Ø´Ø·</div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--gold)">${equip.filter(e=>e.status==='maintenance').length}</div><div class="stat-label">ØµÙŠØ§Ù†Ø©</div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--dim)">${equip.filter(e=>e.status==='idle').length}</div><div class="stat-label">Ø®Ø§Ù…Ù„</div></div>
    </div>
    <div class="grid-cards">${cards}</div>
    <div class="modal-overlay" id="addEquipModal">
      <div class="modal">
        <div class="modal-title">ğŸšœ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø¯Ø©</div>
        <div class="form-grid-2">
          <div class="form-group"><label class="form-label">Ø§Ù„Ø§Ø³Ù… *</label><input class="form-input" id="eName" placeholder="Ø­ÙØ§Ø±Ø©..."></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø·Ø±Ø§Ø²</label><input class="form-input" id="eModel" placeholder="CAT 320"></div>
          <div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</label><input class="form-input" id="ePlate" dir="ltr"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label><select class="form-select" id="eIcon"><option>ğŸšœ</option><option>ğŸš›</option><option>ğŸ—ï¸</option><option>ğŸš§</option><option>â›ï¸</option></select></div>
          <div class="form-group"><label class="form-label">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ (Ø¯Ø¬)</label><input class="form-input" id="ePrice" type="number"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><select class="form-select" id="eProject"><option value="">Ø§Ø®ØªØ±...</option>${projects.map(p=>`<option value="${p.id}">${escHtml(p.name)}</option>`).join('')}</select></div>
        </div>
        <div class="form-group"><label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea class="form-textarea" id="eNotes" style="min-height:60px"></textarea></div>
        <div class="modal-footer"><button class="btn btn-ghost" data-modal-close>Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-gold" onclick="addEquip()">ğŸ’¾ Ø­ÙØ¸</button></div>
      </div>
    </div>
  `);
};

/* â”€â”€â”€ TRANSACTIONS â”€â”€â”€ */
Pages.transactions = function() {
  const tid = Auth.getUser().tenant_id;
  const txs = DB.get('transactions').filter(t=>t.tenant_id===tid);
  const projects = DB.get('projects').filter(p=>p.tenant_id===tid && !p.is_archived);
  const revenue = txs.filter(t=>t.type==='revenue').reduce((s,t)=>s+Number(t.amount),0);
  const expense = txs.filter(t=>t.type==='expense').reduce((s,t)=>s+Number(t.amount),0);

  const rows = [...txs].sort((a,b)=>new Date(b.date)-new Date(a.date)).map(t=>{
    const proj=projects.find(p=>p.id===t.project_id);
    return `<tr>
      <td style="color:var(--dim);font-size:.82rem">${fmtDate(t.date)}</td>
      <td><span class="badge ${t.type==='revenue'?'badge-revenue':'badge-expense'}">${t.type==='revenue'?'Ø¥ÙŠØ±Ø§Ø¯':'Ù…ØµØ±ÙˆÙ'}</span></td>
      <td style="font-size:.84rem">${escHtml(t.description)}</td>
      <td style="font-size:.78rem;color:var(--dim)">${escHtml(t.category)}</td>
      <td style="font-family:monospace;font-weight:700;color:${t.type==='revenue'?'var(--green)':'var(--red)'}">${t.type==='revenue'?'+':'-'}${fmt(t.amount)}</td>
      <td style="font-size:.78rem;color:var(--dim)">${escHtml(proj?.name||'â€”')}</td>
      <td><button class="btn btn-red btn-sm" onclick="deleteTx(${t.id})">ğŸ—‘ï¸</button></td>
    </tr>`;
  }).join('');

  const RCATS = ["Ø¯ÙØ¹Ø© Ø¹Ù…ÙŠÙ„","Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©","Ø¯ÙØ¹Ø© Ù…Ø±Ø­Ù„ÙŠØ©","Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ","Ø¥ÙŠØ±Ø§Ø¯ Ø¢Ø®Ø±"];
  const ECATS = ["Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡","Ø­Ø¯ÙŠØ¯ ØªØ³Ù„ÙŠØ­","Ø£Ø³Ù…Ù†Øª","Ø±Ù…Ù„ ÙˆØ­ØµÙ‰","Ø·ÙˆØ¨","Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø¹Ù…Ø§Ù„","Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ†","Ø§ÙƒØ±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","ÙˆÙ‚ÙˆØ¯","ØµÙŠØ§Ù†Ø©","Ù†Ù‚Ù„ ÙˆÙ…ÙˆØ§ØµÙ„Ø§Øª","Ù…ØµØ§Ø±ÙŠÙ Ø¥Ø¯Ø§Ø±ÙŠØ©","Ø£Ø®Ø±Ù‰"];

  return layoutHTML('transactions','Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©',`
    <div class="page-header">
      <div><div class="page-title">ğŸ’° Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div><div class="page-sub">${txs.length} Ù…Ø¹Ø§Ù…Ù„Ø©</div></div>
      <div class="page-actions"><button class="btn btn-gold" data-modal-open="addTxModal">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø©</button></div>
    </div>
    <div class="stats-grid" style="grid-template-columns:repeat(3,1fr)">
      <div class="stat-card"><div class="stat-icon">ğŸ“ˆ</div><div class="stat-value" style="color:var(--green);font-size:1.1rem">${fmt(revenue)}</div><div class="stat-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø¯Ø¬)</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸ“‰</div><div class="stat-value" style="color:var(--red);font-size:1.1rem">${fmt(expense)}</div><div class="stat-label">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ (Ø¯Ø¬)</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸ’¹</div><div class="stat-value" style="color:${revenue-expense>=0?'var(--green)':'var(--red)'};font-size:1.1rem">${fmt(revenue-expense)}</div><div class="stat-label">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ØµØ§ÙÙŠ (Ø¯Ø¬)</div></div>
    </div>
    ${txs.length?`<div class="table-wrap"><table>
      <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø¬)</th><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø­Ø°Ù</th></tr></thead>
      <tbody>${rows}</tbody></table></div>`:`<div class="empty"><div class="empty-icon">ğŸ’°</div><div class="empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø¹Ø¯</div></div>`}
    <div class="modal-overlay" id="addTxModal">
      <div class="modal">
        <div class="modal-title">ğŸ’° Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø©</div>
        <div class="form-grid-2">
          <div class="form-group"><label class="form-label">Ø§Ù„Ù†ÙˆØ¹</label><select class="form-select" id="txType" onchange="updateTxCats()"><option value="revenue">Ø¥ÙŠØ±Ø§Ø¯</option><option value="expense">Ù…ØµØ±ÙˆÙ</option></select></div>
          <div class="form-group"><label class="form-label">Ø§Ù„ÙØ¦Ø©</label><select class="form-select" id="txCat">${RCATS.map(c=>`<option>${c}</option>`).join('')}</select></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø¬) *</label><input class="form-input" id="txAmount" type="number" placeholder="0"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input class="form-input" id="txDate" type="date" value="${todayStr()}"></div>
          <div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label><select class="form-select" id="txProject"><option value="">â€”</option>${projects.map(p=>`<option value="${p.id}">${escHtml(p.name)}</option>`).join('')}</select></div>
          <div class="form-group"><label class="form-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label><select class="form-select" id="txPayment"><option value="cash">Ù†Ù‚Ø¯ÙŠ</option><option value="bank">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</option><option value="check">Ø´ÙŠÙƒ</option></select></div>
        </div>
        <div class="form-group"><label class="form-label">Ø§Ù„ÙˆØµÙ *</label><input class="form-input" id="txDesc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©..."></div>
        <div class="form-group"><label class="form-label">Ø§Ù„Ù…ÙˆØ±Ø¯</label><input class="form-input" id="txSupplier" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯..."></div>
        <div class="modal-footer"><button class="btn btn-ghost" data-modal-close>Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-gold" onclick="addTx()">ğŸ’¾ Ø­ÙØ¸</button></div>
      </div>
    </div>
  `);
};

/* â”€â”€â”€ ATTENDANCE â”€â”€â”€ */
Pages.attendance = function() {
  const tid = Auth.getUser().tenant_id;
  const workers = DB.get('workers').filter(w=>w.tenant_id===tid);
  const projects = DB.get('projects').filter(p=>p.tenant_id===tid && !p.is_archived);
  const today = todayStr();
  const att = DB.get('attendance');
  const getAtt = (wid,date)=>att.find(a=>a.worker_id===wid && a.date===date);
  const rows = workers.map(w=>{
    const proj=projects.find(p=>p.id===w.project_id);
    const a=getAtt(w.id,today);
    return `<tr>
      <td><div style="display:flex;align-items:center;gap:.7rem"><div style="width:32px;height:32px;border-radius:50%;background:${w.color||'#4A90E2'};display:flex;align-items:center;justify-content:center;font-weight:900;color:#fff;font-size:.75rem">${(w.full_name||'?')[0]}</div><div><div style="font-weight:700;font-size:.85rem">${escHtml(w.full_name)}</div><div style="font-size:.7rem;color:var(--dim)">${escHtml(w.role)}</div></div></div></td>
      <td style="color:var(--dim);font-size:.82rem">${escHtml(proj?.name||'â€”')}</td>
      <td><select class="form-select" style="padding:.3rem .6rem;font-size:.8rem" id="att_${w.id}" onchange="saveAtt(${w.id},'${today}',this.value)">
        <option value="present"${(a?.status||'present')==='present'?' selected':''}>âœ… Ø­Ø§Ø¶Ø±</option>
        <option value="absent"${a?.status==='absent'?' selected':''}>âŒ ØºØ§Ø¦Ø¨</option>
        <option value="halfday"${a?.status==='halfday'?' selected':''}>ğŸ”¶ Ù†ØµÙ ÙŠÙˆÙ…</option>
        <option value="holiday"${a?.status==='holiday'?' selected':''}>ğŸ–ï¸ Ø¥Ø¬Ø§Ø²Ø©</option>
      </select></td>
      <td style="font-family:monospace;font-size:.82rem">${fmt(w.daily_salary)} Ø¯Ø¬</td>
    </tr>`;
  }).join('');
  const todayAtt=att.filter(a=>a.date===today && workers.find(w=>w.id===a.worker_id));
  const present=todayAtt.filter(a=>a.status==='present').length;
  const absent=todayAtt.filter(a=>a.status==='absent').length;
  const totalSalary=workers.reduce((s,w)=>s+Number(w.daily_salary),0);
  return layoutHTML('attendance','Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨',`
    <div class="page-header">
      <div><div class="page-title">ğŸ“… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</div><div class="page-sub">${new Date().toLocaleDateString('ar-DZ',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}</div></div>
      <div class="page-actions">
        <button class="btn btn-green btn-sm" onclick="markAll('present')">âœ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ Ø­Ø§Ø¶Ø±</button>
        <button class="btn btn-red btn-sm" onclick="markAll('absent')">âŒ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„ ØºØ§Ø¦Ø¨</button>
      </div>
    </div>
    <div class="stats-grid" style="grid-template-columns:repeat(4,1fr)">
      <div class="stat-card"><div class="stat-value" style="color:var(--green)">${present}</div><div class="stat-label">Ø­Ø§Ø¶Ø±</div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--red)">${absent}</div><div class="stat-label">ØºØ§Ø¦Ø¨</div></div>
      <div class="stat-card"><div class="stat-value">${workers.length}</div><div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ø§Ù„</div></div>
      <div class="stat-card"><div class="stat-value" style="color:var(--gold);font-size:1rem">${fmt(totalSalary)}</div><div class="stat-label">ØªÙƒÙ„ÙØ© Ø§Ù„ÙŠÙˆÙ… (Ø¯Ø¬)</div></div>
    </div>
    ${workers.length?`<div class="table-wrap"><table>
      <thead><tr><th>Ø§Ù„Ø¹Ø§Ù…Ù„</th><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ</th></tr></thead>
      <tbody>${rows}</tbody></table></div>`:`<div class="empty"><div class="empty-icon">ğŸ“…</div><div class="empty-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ø§Ù„</div></div>`}
  `);
};

/* â”€â”€â”€ REPORTS â”€â”€â”€ */
Pages.reports = function() {
  const tid = Auth.getUser().tenant_id;
  const txs = DB.get('transactions').filter(t=>t.tenant_id===tid);
  const projs = DB.get('projects').filter(p=>p.tenant_id===tid && !p.is_archived);
  const workers = DB.get('workers').filter(w=>w.tenant_id===tid);
  const revenue=txs.filter(t=>t.type==='revenue').reduce((s,t)=>s+Number(t.amount),0);
  const expense=txs.filter(t=>t.type==='expense').reduce((s,t)=>s+Number(t.amount),0);
  const totalBudget=projs.reduce((s,p)=>s+Number(p.budget),0);
  const totalSpent=projs.reduce((s,p)=>s+Number(p.total_spent),0);
  const catMap={};
  txs.filter(t=>t.type==='expense').forEach(t=>{catMap[t.category]=(catMap[t.category]||0)+Number(t.amount);});
  const topCats=Object.entries(catMap).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const maxCat=topCats[0]?.[1]||1;
  return layoutHTML('reports','Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',`
    <div class="page-header"><div class="page-title">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¡</div></div>
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-icon">ğŸ’°</div><div class="stat-value" style="color:var(--green);font-size:1rem">${fmt(revenue)}</div><div class="stat-label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø¯Ø¬)</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸ“‰</div><div class="stat-value" style="color:var(--red);font-size:1rem">${fmt(expense)}</div><div class="stat-label">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ (Ø¯Ø¬)</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸ’¹</div><div class="stat-value" style="color:${revenue-expense>=0?'var(--green)':'var(--red)'};font-size:1rem">${fmt(revenue-expense)}</div><div class="stat-label">Ø§Ù„Ø±Ø¨Ø­ (Ø¯Ø¬)</div></div>
      <div class="stat-card"><div class="stat-icon">ğŸ“Š</div><div class="stat-value" style="color:var(--gold)">${totalBudget>0?Math.round(totalSpent/totalBudget*100):0}%</div><div class="stat-label">Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</div></div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1rem">
      <div class="card">
        <div style="font-weight:800;margin-bottom:1rem">ğŸ—ï¸ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div>
        ${['active','completed','delayed'].map(s=>{const cnt=projs.filter(p=>p.status===s).length;const col=s==='active'?'var(--green)':s==='completed'?'var(--blue)':'var(--red)';return `<div style="display:flex;justify-content:space-between;align-items:center;padding:.5rem 0;border-bottom:1px solid var(--border)"><span style="color:var(--muted);font-size:.84rem">${statusLabel(s)}</span><span style="font-weight:900;color:${col};font-family:monospace">${cnt}</span></div>`;}).join('')}
        <div style="display:flex;justify-content:space-between;align-items:center;padding:.5rem 0"><span style="color:var(--muted);font-size:.84rem">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</span><span style="font-weight:700;font-family:monospace;font-size:.82rem">${fmt(totalBudget)} Ø¯Ø¬</span></div>
      </div>
      <div class="card">
        <div style="font-weight:800;margin-bottom:1rem">ğŸ‘· Ø¥Ø­ØµØ§Ø¡ Ø§Ù„Ø¹Ù…Ø§Ù„</div>
        <div style="display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px solid var(--border)"><span style="color:var(--muted);font-size:.84rem">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ø§Ù„</span><span style="font-weight:900;font-family:monospace">${workers.length}</span></div>
        <div style="display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px solid var(--border)"><span style="color:var(--muted);font-size:.84rem">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø£Ø¬Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠ</span><span style="font-weight:700;font-family:monospace;font-size:.82rem">${workers.length?fmt(Math.round(workers.reduce((s,w)=>s+Number(w.daily_salary),0)/workers.length)):0} Ø¯Ø¬</span></div>
        <div style="display:flex;justify-content:space-between;padding:.5rem 0"><span style="color:var(--muted);font-size:.84rem">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠØ©</span><span style="font-weight:700;font-family:monospace;font-size:.82rem">${fmt(workers.reduce((s,w)=>s+Number(w.daily_salary),0))} Ø¯Ø¬</span></div>
      </div>
    </div>
    ${topCats.length?`<div class="card" style="margin-bottom:1rem"><div style="font-weight:800;margin-bottom:1rem">ğŸ† Ø£ÙƒØ¨Ø± ÙØ¦Ø§Øª Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</div>${topCats.map(([cat,amt])=>`<div style="margin-bottom:.8rem"><div style="display:flex;justify-content:space-between;font-size:.8rem;margin-bottom:4px"><span style="color:var(--muted)">${escHtml(cat)}</span><span style="font-weight:700;font-family:monospace">${fmt(amt)} Ø¯Ø¬</span></div><div class="progress-bar"><div class="progress-fill" style="background:var(--red)" data-width="${Math.round(amt/maxCat*100)}"></div></div></div>`).join('')}</div>`:''}
    <div class="card"><div style="font-weight:800;margin-bottom:1rem">ğŸ’¼ Ø±Ø¨Ø­ÙŠØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</div><div class="table-wrap"><table><thead><tr><th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th><th>Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©</th><th>Ø§Ù„Ù…ÙÙ†ÙÙÙ‚</th><th>Ø§Ù„ØªÙ‚Ø¯Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
      <tbody>${projs.map(p=>`<tr><td><span style="font-weight:700">${escHtml(p.name)}</span></td><td style="font-family:monospace;font-size:.82rem">${fmt(p.budget)}</td><td style="font-family:monospace;font-size:.82rem;color:${p.total_spent>p.budget?'var(--red)':'var(--green)'}">${fmt(p.total_spent)}</td><td><div style="display:flex;align-items:center;gap:.5rem"><div class="progress-bar" style="flex:1"><div class="progress-fill" style="background:${p.color}" data-width="${p.progress}"></div></div><span style="font-size:.75rem;font-weight:700">${p.progress}%</span></div></td><td>${statusBadge(p.status)}</td></tr>`).join('')}</tbody>
    </table></div></div>
  `);
};

/* â”€â”€â”€ SETTINGS â”€â”€â”€ */
Pages.settings = function() {
  const tenant=Auth.getTenant(), plan=Auth.getPlan(), user=Auth.getUser();
  return layoutHTML('settings','Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',`
    <div class="page-header"><div class="page-title">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem">
      <div class="card">
        <div style="font-weight:800;margin-bottom:1rem">ğŸ¢ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</div>
        <div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label><input class="form-input" id="setName" value="${escHtml(tenant?.name||'')}"></div>
        <div class="form-group"><label class="form-label">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label><select class="form-select" id="setWilaya"><option value="">Ø§Ø®ØªØ±...</option>${WILAYAS.map(w=>`<option${tenant?.wilaya===w?' selected':''}>${w}</option>`).join('')}</select></div>
        <div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input class="form-input" id="setPhone" value="${escHtml(tenant?.phone||'')}" placeholder="0550..."></div>
        <div class="form-group"><label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label><input class="form-input" id="setRc" value="${escHtml(tenant?.rc_number||'')}"></div>
        <button class="btn btn-gold" onclick="saveTenantSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
      </div>
      <div>
        <div class="card" style="margin-bottom:1rem">
          <div style="font-weight:800;margin-bottom:1rem">ğŸ‘¤ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø´Ø®ØµÙŠ</div>
          <div style="padding:.6rem 0;border-bottom:1px solid var(--border)"><div style="font-size:.72rem;color:var(--dim)">Ø§Ù„Ø§Ø³Ù…</div><div style="font-weight:700">${escHtml(user.full_name)}</div></div>
          <div style="padding:.6rem 0;border-bottom:1px solid var(--border)"><div style="font-size:.72rem;color:var(--dim)">Ø§Ù„Ø¨Ø±ÙŠØ¯</div><div style="font-weight:700;direction:ltr;text-align:right">${escHtml(user.email)}</div></div>
          <div style="padding:.6rem 0"><div style="font-size:.72rem;color:var(--dim)">Ø§Ù„Ø®Ø·Ø©</div><div style="font-weight:700;color:var(--gold)">${escHtml(plan?.name||'â€”')}</div></div>
        </div>
        <div class="card">
          <div style="font-weight:800;margin-bottom:1rem">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
          <div class="form-group"><label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label><input class="form-input" id="pwCurrent" type="password"></div>
          <div class="form-group"><label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label><input class="form-input" id="pwNew" type="password"></div>
          <div class="form-group"><label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><input class="form-input" id="pwConfirm" type="password"></div>
          <button class="btn btn-blue" onclick="changePassword()">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
        </div>
      </div>
    </div>
  `);
};

/* â”€â”€â”€ ADMIN â”€â”€â”€ */
Pages.admin = function() {
  const tenants=DB.get('tenants'), users=DB.get('users'), plans=DB.get('plans');
  const projects=DB.get('projects'), workers=DB.get('workers');
  const totalRevenue = DB.get('transactions').filter(t=>t.type==='revenue').reduce((s,t)=>s+Number(t.amount),0);

  const rows=tenants.map(t=>{
    const plan=plans.find(p=>p.id===t.plan_id);
    const uCount=users.filter(u=>u.tenant_id===t.id).length;
    const pCount=projects.filter(p=>p.tenant_id===t.id && !p.is_archived).length;
    const wCount=workers.filter(w=>w.tenant_id===t.id).length;
    return `<tr>
      <td><div style="display:flex;align-items:center;gap:.7rem"><div style="width:36px;height:36px;border-radius:10px;background:rgba(232,184,75,.1);border:1px solid rgba(232,184,75,.2);display:flex;align-items:center;justify-content:center;font-size:1rem">ğŸ¢</div><div><div style="font-weight:700">${escHtml(t.name)}</div><div style="font-size:.72rem;color:var(--dim)">${escHtml(t.wilaya||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')}</div></div></div></td>
      <td><span class="badge" style="background:rgba(232,184,75,.1);color:var(--gold);border:1px solid rgba(232,184,75,.2)">${escHtml(plan?.name||'â€”')}</span></td>
      <td style="text-align:center;font-weight:700">${uCount}</td>
      <td style="text-align:center;font-weight:700">${pCount}</td>
      <td style="text-align:center;font-weight:700">${wCount}</td>
      <td><span class="badge ${t.is_active?'badge-active':'badge-delayed'}">${t.is_active?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ'}</span></td>
      <td><button class="btn btn-sm ${t.is_active?'btn-red':'btn-green'}" onclick="toggleTenant(${t.id})">${t.is_active?'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù':'â–¶ï¸ ØªÙØ¹ÙŠÙ„'}</button></td>
    </tr>`;
  }).join('');

  return `<div class="app-shell">${sidebarHTML('admin')}
    <div class="main-wrap">
      ${topbarHTML('Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©')}
      <main class="page-content animate-fade">
        <!-- Header -->
        <div class="page-header">
          <div>
            <div class="page-title">ğŸ‘‘ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</div>
            <div class="page-sub">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ Ø¨Ù€ SmartBTP</div>
          </div>
          <div class="page-actions">
            <button class="btn btn-ghost btn-sm" data-nav="landing">ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
            <button class="btn btn-gold" data-modal-open="addTenantModal">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø³Ø³Ø©</button>
          </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid" style="grid-template-columns:repeat(5,1fr)">
          <div class="stat-card"><div class="stat-icon">ğŸ¢</div><div class="stat-value" style="color:var(--green)">${tenants.filter(t=>t.is_active).length}</div><div class="stat-label">Ù…Ø¤Ø³Ø³Ø§Øª Ù†Ø´Ø·Ø©</div></div>
          <div class="stat-card"><div class="stat-icon">ğŸ‘¤</div><div class="stat-value" style="color:var(--blue)">${users.filter(u=>u.is_active).length}</div><div class="stat-label">Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div></div>
          <div class="stat-card"><div class="stat-icon">ğŸ—ï¸</div><div class="stat-value" style="color:var(--gold)">${projects.filter(p=>!p.is_archived).length}</div><div class="stat-label">Ù…Ø´Ø§Ø±ÙŠØ¹</div></div>
          <div class="stat-card"><div class="stat-icon">ğŸ‘·</div><div class="stat-value" style="color:var(--purple)">${workers.length}</div><div class="stat-label">Ø¹Ù…Ø§Ù„</div></div>
          <div class="stat-card"><div class="stat-icon">ğŸ’°</div><div class="stat-value" style="color:var(--green);font-size:1rem">${fmt(totalRevenue)}</div><div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ø¯Ø¬)</div></div>
        </div>

        <!-- Plan Distribution -->
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem">
          ${plans.map(p=>{
            const cnt=tenants.filter(t=>t.plan_id===p.id).length;
            const pct=tenants.length?Math.round(cnt/tenants.length*100):0;
            const colors=['var(--blue)','var(--gold)','var(--purple)'];
            const idx=plans.indexOf(p);
            return `<div class="card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.8rem"><div style="font-weight:800;font-size:.9rem">Ø®Ø·Ø© ${escHtml(p.name)}</div><span style="font-weight:900;font-size:1.3rem;color:${colors[idx]}">${cnt}</span></div>
              <div class="progress-bar" style="margin-bottom:.4rem"><div class="progress-fill" style="background:${colors[idx]}" data-width="${pct}"></div></div>
              <div style="font-size:.75rem;color:var(--dim)">${fmt(p.price)} Ø¯Ø¬ / Ø´Ù‡Ø± â€¢ ${pct}% Ù…Ù† Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª</div></div>`;
          }).join('')}
        </div>

        <!-- Tenants Table -->
        <div class="card" style="padding:0">
          <div style="padding:1.2rem 1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800">ğŸ¢ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª</div>
            <span style="font-size:.78rem;color:var(--dim)">${tenants.length} Ù…Ø¤Ø³Ø³Ø© Ù…Ø³Ø¬Ù„Ø©</span>
          </div>
          <div class="table-wrap" style="border:none;border-radius:0">
            <table>
              <thead><tr><th>Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</th><th>Ø§Ù„Ø®Ø·Ø©</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</th><th>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</th><th>Ø§Ù„Ø¹Ù…Ø§Ù„</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>

        <!-- Recent Users -->
        <div class="card" style="margin-top:1rem">
          <div style="font-weight:800;margin-bottom:1rem">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div>
          <div class="table-wrap"><table>
            <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
            <tbody>${users.filter(u=>!u.is_admin).map(u=>{
              const tenant=tenants.find(t=>t.id===u.tenant_id);
              return `<tr><td style="font-weight:700">${escHtml(u.full_name)}</td>
                <td style="font-family:monospace;font-size:.82rem;direction:ltr;text-align:right">${escHtml(u.email)}</td>
                <td>${escHtml(tenant?.name||'â€”')}</td>
                <td><span class="badge ${u.is_active?'badge-active':'badge-delayed'}">${u.is_active?'Ù†Ø´Ø·':'Ù…ÙˆÙ‚ÙˆÙ'}</span></td></tr>`;
            }).join('')}</tbody>
          </table></div>
        </div>

        <!-- Add Tenant Modal -->
        <div class="modal-overlay" id="addTenantModal">
          <div class="modal">
            <div class="modal-title">ğŸ¢ Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø³Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
            <div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© *</label><input class="form-input" id="atName" placeholder="Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡..."></div>
            <div class="form-group"><label class="form-label">Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ *</label><input class="form-input" id="atEmail" type="email" placeholder="admin@company.dz" dir="ltr"></div>
            <div class="form-group"><label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± *</label><input class="form-input" id="atPass" type="password" dir="ltr"></div>
            <div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ *</label><input class="form-input" id="atAdmin" placeholder="Ù…Ø­Ù…Ø¯..."></div>
            <div class="form-group"><label class="form-label">Ø§Ù„Ø®Ø·Ø©</label><select class="form-select" id="atPlan">${plans.map(p=>`<option value="${p.id}">${p.name} â€” ${fmt(p.price)} Ø¯Ø¬/Ø´Ù‡Ø±</option>`).join('')}</select></div>
            <div class="modal-footer"><button class="btn btn-ghost" data-modal-close>Ø¥Ù„ØºØ§Ø¡</button><button class="btn btn-gold" onclick="addTenant()">ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</button></div>
          </div>
        </div>
      </main>
      <footer style="padding:.8rem 1.8rem;border-top:1px solid var(--border);display:flex;justify-content:space-between;flex-wrap:wrap;gap:.5rem">
        <span style="font-size:.7rem;color:var(--dim)">Â© 2025 SmartBTP Admin Panel</span>
        <span style="font-size:.7rem;color:var(--dim)">v4.0 Pro Edition</span>
      </footer>
    </div>
  </div>`;
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentTab = 'tenant';
function switchTab(t) {
  currentTab = t;
  document.getElementById('tabTenant')?.classList.toggle('active', t==='tenant');
  document.getElementById('tabAdmin')?.classList.toggle('active', t==='admin');
}

function togglePass() {
  const p = document.getElementById('loginPass');
  if (p) p.type = p.type==='password'?'text':'password';
}

function doLogin() {
  const email = document.getElementById('loginEmail')?.value;
  const pass  = document.getElementById('loginPass')?.value;
  const err   = document.getElementById('loginError');
  if (Auth.login(email, pass, currentTab)) {
    Toast.success('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
    App.navigate(Auth.getUser().is_admin ? 'admin' : 'dashboard');
  } else {
    if (err) err.style.display = 'flex';
    setTimeout(() => { if(err) err.style.display = 'none'; }, 3000);
  }
}

function addProject() {
  const name = document.getElementById('pName')?.value?.trim();
  if (!name) { Toast.error('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹'); return; }
  const tid = Auth.getUser().tenant_id;
  const projs = DB.get('projects');
  projs.push({ id:DB.nextId('projects'), tenant_id:tid, name, wilaya:document.getElementById('pWilaya')?.value||'', client_name:document.getElementById('pClient')?.value||'', phone:document.getElementById('pPhone')?.value||'', budget:Number(document.getElementById('pBudget')?.value)||0, total_spent:0, progress:0, status:'active', color:document.getElementById('pColor')?.value||'#4A90E2', phase:document.getElementById('pPhase')?.value||'', description:document.getElementById('pDesc')?.value||'', start_date:document.getElementById('pStart')?.value||'', end_date:document.getElementById('pEnd')?.value||'', is_archived:false });
  DB.set('projects', projs);
  Toast.success('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹');
  App.navigate('projects');
}

function editProject(id) {
  const p = DB.get('projects').find(p=>p.id===id); if (!p) return;
  document.getElementById('epId').value=id; document.getElementById('epName').value=p.name;
  document.getElementById('epWilaya').value=p.wilaya||''; document.getElementById('epStatus').value=p.status;
  document.getElementById('epProgress').value=p.progress; document.getElementById('epBudget').value=p.budget;
  document.getElementById('epPhase').value=p.phase||''; document.getElementById('epClient').value=p.client_name||'';
  document.getElementById('epEnd').value=p.end_date||'';
  document.getElementById('editProjectModal').classList.add('show');
}

function saveProject() {
  const id=Number(document.getElementById('epId').value);
  const projs=DB.get('projects'); const idx=projs.findIndex(p=>p.id===id); if(idx<0) return;
  projs[idx]={...projs[idx], name:document.getElementById('epName').value, wilaya:document.getElementById('epWilaya').value, status:document.getElementById('epStatus').value, progress:Number(document.getElementById('epProgress').value)||0, budget:Number(document.getElementById('epBudget').value)||0, phase:document.getElementById('epPhase').value, client_name:document.getElementById('epClient').value, end_date:document.getElementById('epEnd').value };
  DB.set('projects',projs); Toast.success('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø´Ø±ÙˆØ¹'); App.navigate('projects');
}

function deleteProject(id,name) {
  if(!confirm(`Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ "${name}"ØŸ`)) return;
  DB.set('projects', DB.get('projects').map(p=>p.id===id?{...p,is_archived:true}:p));
  Toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹'); App.navigate('projects');
}

function addWorker() {
  const name=document.getElementById('wName')?.value?.trim(), role=document.getElementById('wRole')?.value?.trim();
  if(!name||!role){Toast.error('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ù‡Ù†Ø©');return;}
  const tid=Auth.getUser().tenant_id; const ws=DB.get('workers');
  ws.push({ id:DB.nextId('workers'), tenant_id:tid, full_name:name, role, phone:document.getElementById('wPhone')?.value||'', national_id:document.getElementById('wNid')?.value||'', daily_salary:Number(document.getElementById('wSalary')?.value)||0, contract_type:document.getElementById('wContract')?.value||'daily', project_id:Number(document.getElementById('wProject')?.value)||null, hire_date:document.getElementById('wHire')?.value||'', color:document.getElementById('wColor')?.value||'#4A90E2' });
  DB.set('workers',ws); Toast.success('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ù„'); App.navigate('workers');
}

function editWorker(id) {
  const w=DB.get('workers').find(w=>w.id===id); if(!w) return;
  document.getElementById('ewId').value=id; document.getElementById('ewName').value=w.full_name;
  document.getElementById('ewRole').value=w.role; document.getElementById('ewPhone').value=w.phone||'';
  document.getElementById('ewSalary').value=w.daily_salary; document.getElementById('ewContract').value=w.contract_type;
  document.getElementById('ewProject').value=w.project_id||'';
  document.getElementById('editWorkerModal').classList.add('show');
}

function saveWorker() {
  const id=Number(document.getElementById('ewId').value); const ws=DB.get('workers');
  const idx=ws.findIndex(w=>w.id===id); if(idx<0) return;
  ws[idx]={...ws[idx], full_name:document.getElementById('ewName').value, role:document.getElementById('ewRole').value, phone:document.getElementById('ewPhone').value, daily_salary:Number(document.getElementById('ewSalary').value)||0, contract_type:document.getElementById('ewContract').value, project_id:Number(document.getElementById('ewProject').value)||null };
  DB.set('workers',ws); Toast.success('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø§Ù…Ù„'); App.navigate('workers');
}

function deleteWorker(id,name) {
  if(!confirm(`Ø­Ø°Ù Ø§Ù„Ø¹Ø§Ù…Ù„ "${name}"ØŸ`)) return;
  DB.set('workers', DB.get('workers').filter(w=>w.id!==id));
  Toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø§Ù…Ù„'); App.navigate('workers');
}

function exportWorkers() {
  const tid=Auth.getUser().tenant_id; const ws=DB.get('workers').filter(w=>w.tenant_id===tid);
  const projs=DB.get('projects');
  let csv='\uFEFFØ§Ù„Ø§Ø³Ù…,Ø§Ù„Ù…Ù‡Ù†Ø©,Ø§Ù„Ù‡Ø§ØªÙ,Ø§Ù„Ø£Ø¬Ø±,Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯,ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†,Ø§Ù„Ù…Ø´Ø±ÙˆØ¹\n';
  ws.forEach(w=>{const proj=projs.find(p=>p.id===w.project_id);csv+=`"${w.full_name}","${w.role}","${w.phone||''}","${w.daily_salary}","${w.contract_type}","${w.hire_date||''}","${proj?.name||''}"\n`;});
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='workers.csv';a.click();
  Toast.success('ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù CSV');
}

function addEquip() {
  const name=document.getElementById('eName')?.value?.trim();
  if(!name){Toast.error('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø¯Ø©');return;}
  const tid=Auth.getUser().tenant_id; const eq=DB.get('equipment');
  eq.push({ id:DB.nextId('equipment'), tenant_id:tid, name, model:document.getElementById('eModel')?.value||'', plate_number:document.getElementById('ePlate')?.value||'', icon:document.getElementById('eIcon')?.value||'ğŸšœ', status:'active', purchase_price:Number(document.getElementById('ePrice')?.value)||0, project_id:Number(document.getElementById('eProject')?.value)||null, notes:document.getElementById('eNotes')?.value||'' });
  DB.set('equipment',eq); Toast.success('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø¯Ø©'); App.navigate('equipment');
}

function updateEquipStatus(id,status) {
  DB.set('equipment', DB.get('equipment').map(e=>e.id===id?{...e,status}:e));
  Toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø¯Ø©');
}

function deleteEquip(id,name) {
  if(!confirm(`Ø­Ø°Ù "${name}"ØŸ`)) return;
  DB.set('equipment', DB.get('equipment').filter(e=>e.id!==id));
  Toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø¯Ø©'); App.navigate('equipment');
}

const RCATS=["Ø¯ÙØ¹Ø© Ø¹Ù…ÙŠÙ„","Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø©","Ø¯ÙØ¹Ø© Ù…Ø±Ø­Ù„ÙŠØ©","Ø§Ø³ØªÙ„Ø§Ù… Ù†Ù‡Ø§Ø¦ÙŠ","Ø¥ÙŠØ±Ø§Ø¯ Ø¢Ø®Ø±"];
const ECATS=["Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡","Ø­Ø¯ÙŠØ¯ ØªØ³Ù„ÙŠØ­","Ø£Ø³Ù…Ù†Øª","Ø±Ù…Ù„ ÙˆØ­ØµÙ‰","Ø·ÙˆØ¨","Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ø¹Ù…Ø§Ù„","Ù…Ø³ØªØ­Ù‚Ø§Øª Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ†","Ø§ÙƒØ±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø¹Ø¯Ø§Øª","ÙˆÙ‚ÙˆØ¯","ØµÙŠØ§Ù†Ø©","Ù†Ù‚Ù„ ÙˆÙ…ÙˆØ§ØµÙ„Ø§Øª","Ù…ØµØ§Ø±ÙŠÙ Ø¥Ø¯Ø§Ø±ÙŠØ©","Ø£Ø®Ø±Ù‰"];

function updateTxCats() {
  const type=document.getElementById('txType')?.value;
  const cats=type==='revenue'?RCATS:ECATS;
  const sel=document.getElementById('txCat');
  if(sel) sel.innerHTML=cats.map(c=>`<option>${c}</option>`).join('');
}

function addTx() {
  const amount=Number(document.getElementById('txAmount')?.value);
  const desc=document.getElementById('txDesc')?.value?.trim();
  if(!amount||!desc){Toast.error('Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„ÙˆØµÙ');return;}
  const tid=Auth.getUser().tenant_id; const txs=DB.get('transactions');
  const pid=Number(document.getElementById('txProject')?.value)||null;
  const type=document.getElementById('txType')?.value||'expense';
  txs.push({ id:DB.nextId('transactions'), tenant_id:tid, type, category:document.getElementById('txCat')?.value||'Ø£Ø®Ø±Ù‰', amount, description:desc, project_id:pid, date:document.getElementById('txDate')?.value||todayStr(), payment_method:document.getElementById('txPayment')?.value||'cash', supplier:document.getElementById('txSupplier')?.value||'' });
  DB.set('transactions',txs);
  if(type==='expense'&&pid){
    const projs=DB.get('projects'); const pidx=projs.findIndex(p=>p.id===pid);
    if(pidx>=0){projs[pidx].total_spent=DB.get('transactions').filter(t=>t.project_id===pid&&t.type==='expense').reduce((s,t)=>s+Number(t.amount),0);DB.set('projects',projs);}
  }
  Toast.success('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©'); App.navigate('transactions');
}

function deleteTx(id) {
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©ØŸ')) return;
  DB.set('transactions', DB.get('transactions').filter(t=>t.id!==id));
  Toast.success('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©'); App.navigate('transactions');
}

function saveAtt(wid,date,status) {
  const att=DB.get('attendance'); const idx=att.findIndex(a=>a.worker_id===wid&&a.date===date);
  if(idx>=0) att[idx].status=status;
  else att.push({id:DB.nextId('attendance'),worker_id:wid,date,status,hours:8,note:''});
  DB.set('attendance',att);
}

function markAll(status) {
  document.querySelectorAll('select[id^="att_"]').forEach(sel=>{
    const wid=Number(sel.id.split('_')[1]); sel.value=status; saveAtt(wid,todayStr(),status);
  });
  Toast.success(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„: ${status==='present'?'Ø­Ø§Ø¶Ø±':'ØºØ§Ø¦Ø¨'}`);
}

function saveTenantSettings() {
  const tid=Auth.getUser().tenant_id;
  const tenants=DB.get('tenants').map(t=>t.id===tid?{...t,name:document.getElementById('setName')?.value||t.name,wilaya:document.getElementById('setWilaya')?.value||t.wilaya,phone:document.getElementById('setPhone')?.value||t.phone,rc_number:document.getElementById('setRc')?.value||t.rc_number}:t);
  DB.set('tenants',tenants); Toast.success('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
}

function changePassword() {
  const current=document.getElementById('pwCurrent')?.value;
  const newPass=document.getElementById('pwNew')?.value;
  const confirm=document.getElementById('pwConfirm')?.value;
  if(!current||!newPass){Toast.error('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯Ø©');return;}
  if(newPass!==confirm){Toast.error('ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†');return;}
  if(newPass.length<8){Toast.error('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');return;}
  const user=Auth.getUser();
  if(user.password!==current){Toast.error('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');return;}
  const users=DB.get('users').map(u=>u.id===user.id?{...u,password:newPass}:u);
  DB.set('users',users); user.password=newPass; sessionStorage.setItem('sbtp_user',JSON.stringify(user));
  Toast.success('âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
  ['pwCurrent','pwNew','pwConfirm'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
}

function toggleTenant(id) {
  DB.set('tenants', DB.get('tenants').map(t=>t.id===id?{...t,is_active:!t.is_active}:t));
  Toast.success('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¤Ø³Ø³Ø©'); App.navigate('admin');
}

function addTenant() {
  const name=document.getElementById('atName')?.value?.trim();
  const email=document.getElementById('atEmail')?.value?.trim().toLowerCase();
  const pass=document.getElementById('atPass')?.value;
  const admin=document.getElementById('atAdmin')?.value?.trim();
  const planId=Number(document.getElementById('atPlan')?.value);
  if(!name||!email||!pass||!admin){Toast.error('Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');return;}
  const users=DB.get('users');
  if(users.find(u=>u.email===email)){Toast.error('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„');return;}
  const tenants=DB.get('tenants');
  const newTenant={id:DB.nextId('tenants'),name,plan_id:planId,wilaya:'',is_active:true,subscription_status:'active'};
  tenants.push(newTenant); DB.set('tenants',tenants);
  users.push({id:DB.nextId('users'),tenant_id:newTenant.id,full_name:admin,email,password:pass,role:'admin',is_admin:false,is_active:true});
  DB.set('users',users); Toast.success(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¤Ø³Ø³Ø© "${name}" Ø¨Ù†Ø¬Ø§Ø­`); App.navigate('admin');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SMOOTH SCROLL FOR LANDING ANCHORS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('click', e => {
  const a = e.target.closest('a[href^="#"]');
  if (a) { e.preventDefault(); const el = document.querySelector(a.getAttribute('href')); if(el) el.scrollIntoView({behavior:'smooth'}); }
});

document.addEventListener('keydown', e => {
  if (e.key === 'Enter' && document.getElementById('loginPass') === document.activeElement) doLogin();
});

DB.init();
Auth.load();
App.render();
</script>
</body>
</html>
